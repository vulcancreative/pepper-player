!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("pepper",[],t):"object"==typeof exports?exports.pepper=t():e.pepper=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=14)}([function(e,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)},i=function(e){return null!==e&&"undefined"!==(void 0===e?"undefined":r(e))};t.default={def:i,ndef:function(e){return!i(e)},fnc:function(e){return i(e)&&"function"==typeof e.call},a:function(e,t){return t.getAttribute(e)},q:function(e,t){return function(e,t){return[].slice.call(t.querySelectorAll(e))}(e,t)}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.kMPDType={static:"static",dynamic:"dynamic"},t.kProtocol={hls:"HLS",dash:"DASH"},t.kStreamType={audio:"audio",video:"video",muxed:"muxed",image:"image"},t.kSegmentType={init:"initialization",segment:"segment"},t.kTransitions={countdown:"countdown",immedaite:"immediate"},t.kBackingType={splitX:"splitX",splitY:"splitY",uniform:"uniform"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sizeDict=function(e){return Object.keys(e).length},t.mergeDicts=function(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var u,s=Object.keys(t)[Symbol.iterator]();!(r=(u=s.next()).done);r=!0){var o=u.value;n[o]=null!==e[o]&&void 0!==e[o]?e[o]:t[o]}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n},t.randInt=function(e,t){return parseInt(Math.floor(Math.random()*(t-e+1)+e))},t.isInt=function(e){if(isNaN(e))return!1;var t=parseFloat(e);return(0|t)===t}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toInt=function(e){var t=e%1,n=parseInt(e);return isNaN(t)||isNaN(n)?null:n},t.msToStamp=function(e){for(var t="",n=1e3*Math.floor(e>-1?e:0)/1e3,r=0,i=0,a=0;n>=36e5;)n-=36e5,r++;for(;n>=6e4;)n-=6e4,i++;return a=n/1e3,r>0&&(t+=r+":"),t+(r>0?(""+i.toFixed(0)).padStart(2,"0"):""+i)+":"+(""+a.toFixed(0)).padStart(2,"0")},t.toDuration=function(e){var t=[0,0,31536e6,254016e4,6048e5,864e5,36e5,6e4,1e3];return e.match(/(-)?P(?:([.,\d]+)Y)?(?:([.,\d]+)M)?(?:([.,\d]+)W)?(?:([.,\d]+)D)?T(?:([.,\d]+)H)?(?:([.,\d]+)M)?(?:([.,\d]+)S)?/).reduce(function(e,n,r){return r<2?0:null===n||void 0===n?e+0:e+n*t[r]})},t.arrayBufferToBase64=function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return btoa(t)}},function(e,t){"use strict";function n(e,t){var n=(8*(t<1?e*(1/t):e)/t).toFixed(2);return parseFloat(n)}function r(){if(i.length<1)return 0;var e=(i.reduce(function(e,t){return e+t},0)/i.length).toFixed(2);return parseFloat(e)}Object.defineProperty(t,"__esModule",{value:!0});var i=[];t.bps=n,t.kbps=function(e,t){return parseFloat((n(e,t)/1024).toFixed(2))},t.bpsAvg=r,t.kbpsAvg=function(){return parseFloat((r()/1024).toFixed(2))},t.speedFactor=function(e,t,n){var r=n/1e3,i=(parseFloat(8*t/(1024*e))/parseFloat(r)).toFixed(2);return parseFloat(i)},t.pushBpsHistory=function(e){for(i.push(e);i.length>15;)i.shift()},t.clearBpsHistory=function(){for(;i.length>0;)i.shift()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=(r=n(0))&&r.__esModule?r:{default:r},u=function(){function e(t){!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.hooks=t||{}}return i(e,[{key:"run",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return new Promise(function(){var n=t.hooks[e];a.default.def(n)&&a.default.fnc(n)&&n.apply(void 0,r)})}}]),e}();t.default=u},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=navigator,r=n.userAgent+" "+n.oscpu;t.default={is:function(e,t,n){switch(t=(t||r).toLowerCase(),e=e.toLowerCase()){case"opera":n=/opera|opr\//.test(t);break;case"safari":n=/^((?!chrome).)*safari/.test(t);break;case"ie":n=t.indexOf("trident")>-1;break;default:n=t.indexOf(e.toLowerCase())>-1}return n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=(r=n(0))&&r.__esModule?r:{default:r},a=0,u=!1,s=function(){return Date.now()-a},o=function(e){var t=i.default.def(e)?new Date(e):new Date,n=Date.now()-s();return u?new Date(t.getTime()-n):t};t.default={init:o,now:s,parse:function(e){return o(e)},sync:function(e){a=0,a=s()-e,u=!0},synced:function(){return u}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.repToM3U8=t.mpdToM3U8=t.hlsPreferred=t.hlsSupported=t.hlsMimeType=void 0;var r,i=(r=n(6))&&r.__esModule?r:{default:r},a=n(1),u="\n",s="application/vnd.apple.mpegurl",o=function(e){var t=document.createElement("video");return i.default.is("safari")&&e&&e.live||t.canPlayType&&!!t.canPlayType("application/vnd.apple.mpegurl")&&!("MediaSource"in window)},l=function(e,t){var n=e.mpd,r=t.segmentLength(),i=function(e,t,n){var r=e.mpd;return(r.type===a.kMPDType.dynamic?t.timeline.slice(0,10):Array(Math.ceil(r.duration/n)).fill()).map(function(e,i){return"#EXTINF:"+parseFloat(n/1e3).toFixed(5)+",\n    "+t.mediaURL(r.type===a.kMPDType.dynamic?e:i+1)})}(e,t,r),o="#EXTM3U\n#EXT-X-TARGETDURATION:"+parseInt(Math.ceil(r/1e3))+"\n#EXT-X-VERSION:7\n#EXT-X-PLAYLIST-TYPE:"+(n.type===a.kMPDType.static?"VOD":"EVENT")+'\n#EXT-X-INDEPENDENT-SEGMENTS\n#EXT-X-MAP:URI="'+t.initURL()+'"\n'+i.join(u)+u+(n.type===a.kMPDType.static?"#EXT-X-ENDLIST":""),l=new Blob([o],{type:s});return URL.createObjectURL(l)};t.hlsMimeType=s,t.hlsSupported=o,t.hlsPreferred=function(e){return o(e)},t.mpdToM3U8=function(e){var t,n=(t=[]).concat.apply(t,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e.mpd.adps.map(function(e){return e.reps}))),r=n.filter(function(e){return e.type===a.kStreamType.audio}),i=n.filter(function(e){return e.type===a.kStreamType.video}),s=r.map(function(t){var n=l(e,t);return'#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="'+t.id+'",NAME="'+t.id+'",LANGUAGE="en-US",AUTOSELECT=YES,DEFAULT=YES,CHANNELS="2",URI="'+n+'"'}),o=i.map(function(t){var n=l(e,t);return"#EXT-X-STREAM-INF:BANDWIDTH="+t.bandwidth+',CODECS="'+t.codecs+(r&&r.length>=1?","+r[0].codecs:"")+'",RESOLUTION='+t.width+"x"+t.height+","+(r&&r.length>=1?'AUDIO="'+r[0].id+'"\n':"")+n});return"#EXTM3U\n#EXT-X-VERSION:7\n#EXT-X-INDEPENDENT-SEGMENTS\n"+s.join(u)+u+o.join(u)},t.repToM3U8=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(0)),u=r(n(5)),s=n(4),o=n(2),l=n(3),c=n(1),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.default;!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.config=(0,o.mergeDicts)(t,{adp:null,id:null,mediaSource:null,mpd:null,sources:null}),this.hooks=n,this.mediaSource=this.config.mediaSource,this.adp=this.config.adp,this.id=this.config.id,this.mpd=this.config.mpd,this.sources=this.config.sources,this.mpdWasUpdated=!1}return i(e,[{key:"setup",value:function(){var e=this;return new Promise(function(t){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(e.init_());case 2:e.cache=n.sent,t();case 4:case"end":return n.stop()}},null,e)})}},{key:"init_",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new Promise(function(n){var r,i,a,u,s;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=e.rep(),e.type=r.type,e.codecs=r.mimeType+'; codecs="'+r.codecs+'"',MediaSource.isTypeSupported(e.codecs)){o.next=6;break}return n(t),o.abrupt("return");case 6:return e.buffer=e.mediaSource.addSourceBuffer(e.codecs),e.buffer.mode="sequence",e.mpd.type===c.kMPDType.dynamic&&(e.buffer.timestampOffset=.1),i=!1,o.next=12,regeneratorRuntime.awrap(Promise.all(e.sources.map(function(n){return new Promise(function(r){var a=n.initURL();e.fetchSegment_(a).then(function(a){i||(e.hooks.run("onBufferStart"),i=!0);var u={type:c.kSegmentType.init,rep:n.id,point:0,data:a,size:a.byteLength};t.push(u),r(u)})})})));case 12:for(a=o.sent,u=0;u!=a.length;u++)0===(s=a[u]).point&&s.rep===r.id&&e.appendBuffer(e.buffer,s).then(function(t){e.buffer=t,n()}).catch(function(){n()});e.hooks.run("onBufferEnd"),n(t);case 16:case"end":return o.stop()}},null,e)})}},{key:"fetchSegment_",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=0,r=(new Date).getTime();return new Promise(function(i,a){var u=e.rep().id,o=e.mpd.type,l=new XMLHttpRequest,f=e.segmentLength();l.onload=function(){if(l.status>=400&&o===c.kMPDType.dynamic)i(null);else if(l.status>=200&&l.status<400){var e=l.response;n+=e.byteLength;var d=((new Date).getTime()-r)/1e3;d>f&&(0,s.clearBpsHistory)(),(0,s.pushBpsHistory)((0,s.bps)(n,d)),i(e)}else a('Unable to fetch segment at "'+t+'" for rep "'+u+'"')};var d=(new Date).getTime();l.open("GET",o===c.kMPDType.dynamic?t.includes("?")?t+"&timestamp="+d:t+"?timestamp="+d:t),l.responseType="arraybuffer",l.send()})}},{key:"appendBuffer",value:function(e,t){var n=this;return new Promise(function(r,i){n.rep(),a.default.ndef(e)&&i("Buffer invalid!"),a.default.ndef(t)&&i("Segment invalid!");var u=function(){try{e.appendBuffer(new Uint8Array(t.data))}catch(e){}};e.updating?e.onupdateend=function(){u(),e.onupdateend=function(){return r(e)}}:(u(),e.onupdateend=function(){return r(e)})})}},{key:"bufferedLength",value:function(){var e=this.cache.length;return e<2?0:Math.round((e-1)*this.segmentLength())}},{key:"fillBuffer",value:function(e){var t=this;return new Promise(function(n){var r,i,u,s;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return r=t.rep(),i=r.mediaURL(e),u=void 0,o.prev=3,o.next=6,regeneratorRuntime.awrap(t.fetchSegment_(i));case 6:u=o.sent,o.next=12;break;case 9:o.prev=9,o.t0=o.catch(3);case 12:if(!a.default.ndef(u)){o.next=15;break}return n(null),o.abrupt("return");case 15:if(t.type!==c.kStreamType.image){o.next=19;break}return t.cache.push({point:e,mime:r.mimeType,data:(0,l.arrayBufferToBase64)(u),info:r.tileInfo}),n(u.byteLength),o.abrupt("return");case 19:return t.cache.push({type:c.kSegmentType.segment,point:e,data:u,size:u.byteLength}),s=t.cache.length-1,o.prev=21,o.next=24,regeneratorRuntime.awrap(t.appendBuffer(t.buffer,t.cache[s]));case 24:t.buffer=o.sent,o.next=31;break;case 27:o.prev=27,o.t1=o.catch(21),n(null);case 31:n(u.byteLength);case 32:case"end":return o.stop()}},null,t,[[3,9],[21,27]])})}},{key:"inCache",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[],r=function(t){var n=0,r=e.cache.length-1,i=void 0,a=e.cache.length-1;if(e.cache.length>0&&e.cache[a].point===t)return a;for(;n<=r;)if((i=e.cache[a=(n+r)/2|0]).point<t)n=a+1;else{if(!(i.point>t))return a;r=a-1}return-1},i=0;i!=t.length;i++){var a=t[i];r(a)>-1&&n.push(a)}if(t.constructor===Array)for(var u=0;u!=t.length;u++){var s=t[u];r(s)>-1&&n.push(s)}else{if(!(0,o.isInt)(t))throw'Invalid argument value : "'+t+'"';var l=t;r(l)>-1&&n.push(l)}return n}},{key:"makePoints",value:function(e,t,n){var r,i=this.rep(),a=this.lastPoint||0,u=function(e){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(t.push(a.value),2!==t.length);n=!0);}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}return t}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(i.makePoints(this.mpd,e,t,n,a));return r=u[0],this.lastPoint=a=u[1],r}},{key:"popCache",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise(function(n,r){var i=0;e.cache.length<t+1&&n();for(var a=1;a<e.cache.length;a++)if(e.cache[a].type!==c.kSegmentType.init&&e.cache[a-1].type===c.kSegmentType.init&&e.cache[a].type===c.kSegmentType.segment){i=a;break}0===i&&r(),i+1+t>e.cache.length&&r(),e.cache.splice(i,t),n()})}},{key:"rep",value:function(){return this.mpd.repByID(this.id)}},{key:"segmentLength",value:function(){var e=this.rep();if(a.default.ndef(e))throw'Unable to determine segment length of rep "'+e.id+'"';return e.segmentLength()}},{key:"switchToRep",value:function(e){var t=this;return new Promise(function(n){for(var r=0;r!=t.cache.length;r++){var i=t.cache[r];0===i.point&&i.rep===e&&t.appendBuffer(t.buffer,i).then(function(r){t.buffer=r;for(var i=0;i!=t.sources.length;i++){var a=t.sources[i];if(a.id===e){t.id=a.id;break}}n()}).catch(function(){n()})}})}},{key:"updateMPD",value:function(){this.mpdWasUpdated=!0}}]),e}();t.Stream=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(0)),u=r(n(6)),s=n(3),o=n(1),l="",c="mimeType",f="SegmentList",d="SegmentTimeline",p="SegmentTemplate",h="SegmentURL",v="duration",m=function(){function e(t,n,r,i,m){!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.presentationTime=m;var y,g,b,k,w,T,P,S=void 0,x=void 0,_=void 0,M=void 0,R=void 0,D=void 0,E=void 0,I=void 0,L=void 0,B=void 0,q=void 0,A=void 0,U=void 0;y=a.default.a("id",n),B=a.default.a(c,t),a.default.ndef(B)&&(B=a.default.a(c,n)),g=a.default.a("codecs",n);var O=a.default.a("width",n),N=a.default.a("height",n);b=(0,s.toInt)(O)||0,k=(0,s.toInt)(N)||0;var j=a.default.a("bandwidth",n);w=(0,s.toInt)(j),S=i||l;var C=r.split("/"),F=C.length;if(S=F>1?C.slice(0,F-1).join("/"):"/",S+="/"===S.charAt(S.length-1)?l:"/",T=a.default.q(f,n)[0],R=a.default.q(p,n)[0],T||R||(R=a.default.q(p,t)[0]),T&&(_=a.default.q(h,n).map(function(e){return a.default.a("media",e)}),x=a.default.q("Initialization",n)[0],x=a.default.a("sourceURL",x)),R&&(M=a.default.a("media",R),x=a.default.a("initialization",R),a.default.def(x)&&(x=x.replace("$RepresentationID$",y))),T||R){var X=a.default.a("startNumber",T||R);I=(0,s.toInt)(X);var H=a.default.a("timescale",T||R);L=(0,s.toInt)(H);var z=a.default.a(v,T||R);q=(0,s.toInt)(z)}if(P=a.default.q(d,t)[0],a.default.def(P)){var $=[];if(u.default.is("edge"))for(var Q=P.childNodes,Y=0;Y!=Q.length;Y++){var G=Q[Y];"s"===G.nodeName.toLowerCase()&&$.push(G)}else $=P.children;E=$,D=this.timeline_($,I)}if(B&&B.includes("video")&&b&&k?A=o.kStreamType.video:B&&B.includes("audio")&&w?A=o.kStreamType.audio:B&&B.includes("image")&&(A=o.kStreamType.image),A===o.kStreamType.image){var W="1x1",V=a.default.a(v,R),K=a.default.q("EssentialProperty",n)[0];K&&(W=a.default.a("value",K)),U={duration:1e3*parseInt(V),count:parseInt(W.split("x")[0]),width:b,height:k}}this.id=y,this.mimeType=B,this.codecs=g,this.width=b,this.height=k,this.bandwidth=w,this.baseURL=S,this.listParts=_,this.timelineParts=E,this.timeline=D,this.mediaTemplate=M,this.initialization=x,this.startNumber=I&&void 0!==I?I:null,this.timescale=L,this.segmentDuration=q,this.tileInfo=U,this.type=A}return i(e,[{key:"initURL",value:function(){var e=this.initialization,t=this.baseURL;return e?(t?""+t+e:e).replace(/\$RepresentationID\$/g,""+this.id):t||"/"}},{key:"makePoints",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return a.default.def(this.timeline)?this.makeTimelinePoints(i):[this.makeTemplatePoints(e,t,n,r),null]}},{key:"makeTimelinePoints",value:function(e){for(var t=0,n=e,r=[],i=void 0;n<=e;)n=this.timeline[t++];if(this.timeline.length>=5+(t-=1))i=t+5;else{var a=this.timeline.length-t;if(a<=0)return[[],e];i=t+a-1}for(;t<i;)r.push(this.timeline[t]),t++;if((r=r.filter(function(e,t,n){return n.indexOf(e)===t})).length<1)return[[],e];for(var u=0;u!=r.length;u++)if(e>=r[u])throw"last >= data";return this.startNumber?[r,r[r.length-1]]:[r,r[r.length-1]+this.segmentLength()]}},{key:"makeTemplatePoints",value:function(e,t,n,r){var i=this.segmentLength();if(e.type===o.kMPDType.static){if(this.type===o.kStreamType.image&&null!==this.tileInfo){var a=Math.ceil(e.duration/this.tileInfo.duration);return new Array(a).fill(0).map(function(e,t){return t+1})}var u=parseInt(Math.ceil(parseFloat((n<t?t+1e3:n)-t)/parseFloat(i))),s=parseInt(Math.ceil(parseFloat(t)/parseFloat(i)));return new Array(u).fill(s).map(function(e,t){return e+(t+1)})}if(e.type===o.kMPDType.dynamic){var l=Math.abs(r-e.startTime);return n&&n>r?Array(1+(n-r)/i).fill().map(function(e,t){return(l+i*t)/i-10}):[Math.ceil(l/i-10)]}throw'Unable to decipher source type ("'+e.type+'")'}},{key:"mediaURL",value:function(e){var t=/\$Time\$/g,n=/\$Number\$/g,r=void 0;if(this.listParts)r=e-1>0&&e-1<this.listParts.length?this.listParts[e-1]:this.listParts[0];else{var i=""+e;if(r=this.mediaTemplate.replace(/\$RepresentationID\$/g,""+this.id),t.test(r)&&this.timeline.length>0)r=r.replace(t,i);else if(/(\$Number%(\d+)d\$)/g.test(r)){var a=/(\$Number%(\d+)d\$)/g.exec(r),u=parseInt(a[a.length-1])+1,s=i.padStart(u-1,"0");r=(r=r.replace(a[0],s)).replace(n,i)}else r=r.replace(n,i)}var o=this.baseURL;return o?""+o+r:r}},{key:"segmentLength",value:function(){if(this.timelineParts&&this.timelineParts.length>0){for(var e=[],t=0;t<this.timelineParts.length;t++){var n=this.timescale,r=parseInt(this.timelineParts[t].getAttribute("d"));e.push(r/n)}if(e.length>0)return e.reduce(function(e,t){return e+t})/e.length*1e3}var i=parseFloat(this.timescale),u=parseFloat(this.segmentDuration);if(a.default.ndef(i)||isNaN(i))return 1e3*u;var s=Math.floor(u/i);return 1e3*parseInt(s)}},{key:"weight",value:function(){return this.width+this.height+this.bandwidth}},{key:"timeline_",value:function(e,t){var n=[];if(t)for(var r=0;r<5;r++)n.push(t+r);else for(var i=0,u=0;u!=e.length;u++){var s=e[u],o=parseInt(a.default.a("t",s)),l=parseInt(a.default.a("d",s)),c=parseInt(a.default.a("r",s));o-=this.presentationTime,c=isNaN(c)||c<1?1:c;for(var f=a.default.def(o)&&!isNaN(o)?o:i,d=0;d!=c;d++){var p=f+l*(d+1);n.push(p),i=p}}return n}}]),e}();t.default=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(0)),u=r(n(10)),s=n(3),o=function(){function e(t,n,r,i,u){!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var o=a.default.a("maxWidth",t),l=a.default.a("maxHeight",t);this.adp=t,this.index=n,this.maxWidth=(0,s.toInt)(o),this.maxHeight=(0,s.toInt)(l),this.reps=this.reps_(t,r,i,u)}return i(e,[{key:"reps_",value:function(e,t,n,r){var i=a.default.q("Representation",e);if(i&&i.length>0){for(var s=[],o=0;o!=i.length;o++)s.push(new u.default(e,i[o],t,n,r));var l=s.map(function(e){return a.default.ndef(e.bandwidth)?null:e.bandwidth});if(l.includes(null)){var c=l.findIndex(function(e){return null!==e}),f=c>-1?l[c]:0;s=s.map(function(e){return e.bandwidth=f,e})}return s.sort(function(e,t){return e.weight()<t.weight()?-1:1}),s}throw"No representations present in adaptation["+this.index+"]"}},{key:"bestRep",value:function(e){return a.default.def(e)?this.matchBandwidth(e):this.reps[this.reps.length-1]}},{key:"matchBandwidth",value:function(e){var t=e,n=this.reps.map(function(e){return e.bandwidth}).reduce(function(e,n){return Math.abs(n-t)<Math.abs(e-t)?n:e});return this.reps.find(function(e){return e.bandwidth===n})}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MPD=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(0)),u=r(n(11)),s=r(n(7)),o=n(4),l=n(1),c=n(2),f=n(3),d="",p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.config=(0,c.mergeDicts)(t,{url:d,base:d,data:null})}return i(e,[{key:"setup",value:function(){var e,t,n,r,i;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return e=0,t=(new Date).getTime(),n=void 0,a.next=4,regeneratorRuntime.awrap(this.fetch_(this.config.url,this.config.data));case 4:if(e+=(r=a.sent).length,n=(new Date).getTime(),(0,o.pushBpsHistory)((0,o.bps)(e,(n-t)/1e3)),!(i=this.parse_(r))){a.next=12;break}throw i;case 12:return a.abrupt("return",Promise.resolve(this));case 14:case"end":return a.stop()}},null,this)}},{key:"fetch_",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments[1];return new Promise(function(n){a.default.def(t)&&n(t,"data");var r=new XMLHttpRequest;r.onload=function(){var e=r.response;if(a.default.def(e)&&e.includes(""+l.kMPDType.dynamic)){var t=r.getResponseHeader("Date"),i=new Date(t);s.default.sync(i)}n(e,"xml")};var i=(new Date).getTime();r.open("GET",e.includes("?")?e+"&timestamp="+i:e+"?timestamp="+i),r.send()})}},{key:"parse_",value:function(e){var t=this.config.url,n=this.config.base;return this.mpd=this.xml_(e),this.baseURL=this.baseURL_(this.mpd,n),this.startTime=this.startTime_(this.mpd),this.adps=this.adps_(this.mpd,t,this.baseURL,this.startTime),this.duration=this.duration_(this.mpd),this.dvr=this.dvr_(this.mpd),this.muxed=this.muxed_(this.mpd),this.type=this.type_(this.mpd),this.updatePeriod=this.updatePeriod_(this.mpd),this.adps<0?"Bad adps":this.type==l.kMPDType.static&&-1==this.duration?"Bad duration":this.type<0?"Bad type":this.type==l.kMPDType.dynamic&&(-1==this.startTime||isNaN(this.startTime)||a.default.ndef(this.startTime))?"Bad start":this.type==l.kMPDType.dynamic&&this.updatePeriod<0?"Bad update":null}},{key:"adps_",value:function(e,t,n,r){var i=a.default.q("Period",e)[0],s=a.default.q("AdaptationSet",i);if(!s||s.length<1)return-1;for(var o=[],l=0;l!=s.length;l++)o.push(new u.default(s[l],l,t,n,r));return o}},{key:"baseURL_",value:function(e,t){var n=d;return t&&(n=""+t),n.length<1&&(n=(n=a.default.q("MPD BaseURL",e)[0])&&n.textContent?n.textContent.trim():"/"),n+("/"!==n.charAt(n.length-1)?"/":d)}},{key:"duration_",value:function(e){var t=a.default.q("MPD",e)[0],n=a.default.a("mediaPresentationDuration",t);return a.default.ndef(n)||!n.hasOwnProperty("length")||n.length<1?-1:(0,f.toDuration)(n)}},{key:"dvr_",value:function(e){var t=a.default.q("MPD",e)[0],n=a.default.a("timeShiftBufferDepth",t);return a.default.ndef(n)||!n.hasOwnProperty("length")||n.length<1?-1:(0,f.toDuration)(n)}},{key:"muxed_",value:function(e){var t=a.default.q("Representation",e)[0];if(!t)return-1;var n=a.default.a("codecs",t);return n.includes("avc")&&n.includes("mp4")}},{key:"type_",value:function(e){var t=a.default.q("MPD",e)[0],n=a.default.a("type",t);return n&&n.trim()!==d?n.trim():-1}},{key:"startTime_",value:function(e){var t=a.default.q("MPD",e)[0],n=a.default.a("availabilityStartTime",t);return a.default.ndef(n)?-1:s.default.parse(n)}},{key:"updatePeriod_",value:function(e){var t=a.default.q("MPD",e)[0],n=a.default.a("minimumUpdatePeriod",t);if(a.default.ndef(n))return-1;var r=(0,f.toDuration)(n);return r<1e3?1e3:r}},{key:"xml_",value:function(e){return e.querySelectorAll?e:(new DOMParser).parseFromString(e,"text/xml",0)}},{key:"repByID",value:function(e){for(var t=0;t<this.adps.length;t++)for(var n=this.adps[t],r=0;r<n.reps.length;r++){var i=n.reps[r];if(i.id===e)return i}throw"Unable to find rep with ID '"+e+"'"}}]),e}();t.MPD=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(0)),u=r(n(7)),s=r(n(5)),o=n(12),l=n(9),c=n(2),f=n(1),d=n(4),p=n(8),h="",v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.default;!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.config=(0,c.mergeDicts)(t,{playlist:[],base:0,lead:0,start:0,timed:0,track:0,query:h}),this.config.query+=this.config.query.match(/(^|\s)video(\s|\.|$)/)?h:" video",this.hooks=n}return i(e,[{key:"setup",value:function(e){var t=this;return new Promise(function(n,r){var i;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:if((i=document.querySelector(t.config.query)).style.display="block",a.default.ndef(i)&&r("No injection point"),i.onerror=function(){i.style.display="none",setTimeout(function(){return e()},1e3)},i.addEventListener("encrypted",function(){var e=a.default.q(t.config.query,document)[0].mediaKeys;if((null===e||void 0===e)&&window.navigator.requestMediaKeySystemAccess)try{navigator.requestMediaKeySystemAccess("com.widevine.alpha",[{initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}],videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"',robustness:"SW_SECURE_CRYPTO"}]}]).then(function(){}).catch(function(){})}catch(e){}}),t.video=i,t.paused=!0,t.loading=!1,t.started=!1,t.qualityAuto=!0,t.qualityQueued=null,t.bufferTime=t.config.start,!(t.config.timed>0)){u.next=17;break}return n(),u.abrupt("return");case 17:return t.mpdUpdateInterval&&clearInterval(t.mpdUpdateInterval),u.next=20,regeneratorRuntime.awrap(t.init_());case 20:t.hooks.run("onReady"),n();case 22:case"end":return u.stop()}},null,t)})}},{key:"init_",value:function(){var e=this;return a.default.def(this.mpd)?Promise.resolve():new Promise(function(t){var n;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return e.mpd=new o.MPD({url:e.config.playlist[n=e.config.track].dash.url,base:e.config.playlist[n].dash.base}),r.next=6,regeneratorRuntime.awrap(e.mpd.setup());case 6:return e.mpd=r.sent,r.next=9,regeneratorRuntime.awrap(e.mediaSource_());case 9:if(e.mediaSource=r.sent,!e.usingHLS()){r.next=13;break}return t(),r.abrupt("return");case 13:if(e.usingHLS()){r.next=19;break}return r.next=16,regeneratorRuntime.awrap(e.buildStreams_(e.mpd,e.mediaSource));case 16:r.t0=r.sent,r.next=20;break;case 19:r.t0=null;case 20:e.streams=r.t0,e.mpd.type===f.kMPDType.dynamic&&(e.mpdUpdateInterval=setInterval(function(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(e.mpd.setup());case 2:e.mpd=t.sent;case 3:case"end":return t.stop()}},null,e)},e.mpd.updatePeriod)),t();case 23:case"end":return r.stop()}},null,e)})}},{key:"buildStreams_",value:function(e,t){var n=this;return new Promise(function(r){for(var i=0,a=[],u=function(u){var s=e.adps[u],o=s.bestRep(4*(0,d.bpsAvg)()),c=new l.Stream({adp:s,id:o.id,mediaSource:t,mpd:e,sources:e.adps[u].reps},n.hooks);c.setup().then(function(){a.push(c),++i===e.adps.length&&r(a)})},s=0;s<e.adps.length;s++)u(s)})}},{key:"mediaSource_",value:function(){var e=this;return new Promise(function(t,n){if(e.usingHLS()){var r=e.config.playlist[e.config.track].hls;if(r.url&&r.url.length&&r.url.length>0)e.video.type=p.hlsMimeType,e.video.src=r.url,t(null);else{var i=(0,p.mpdToM3U8)(e),a="data:"+p.hlsMimeType+";base64,"+btoa(i);e.video.type=p.hlsMimeType,e.video.src=a,t(null)}}else{var u=new MediaSource;u.addEventListener("sourceopen",function(){"open"===u.readyState?t(u):n("MediaSource failed")}),e.video.src=e.url_(u)}})}},{key:"url_",value:function(e){if(a.default.def(e))return URL.createObjectURL(e);throw"MediaSource failed"}},{key:"adjustQuality",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.loading?Promise.resolve(!1):new Promise(function(r){var i,a,u,s;return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:if(e.qualityAuto||null===e.qualityQueued){o.next=15;break}return i=e.videoStream(),a=e.qualityQueued.rep.id,e.qualityQueued=null,o.next=9,regeneratorRuntime.awrap(i.switchToRep(a));case 9:e.loading=!1,e.hooks.run("onAdapt",e.currentBitrate()),r(!0),o.next=25;break;case 15:if(!e.qualityAuto){o.next=23;break}if(null!==e.streams&&void 0!==e.streams){o.next=19;break}return r(!1),o.abrupt("return");case 19:for(u=function(i){var a=e.streams[i],u=a.adp,s=void 0;if(n>=.5){var o=e.mpd.repByID(a.id);s=u.matchBandwidth(.8*o.bandwidth)}else s=u.matchBandwidth(t);a.id!==s.id?a.switchToRep(s.id).then(function(){i===e.streams.length-1&&(e.loading=!1,e.hooks.run("onAdapt",e.currentBitrate()),r(!0))}):(e.loading=!1,r(!1))},s=0;s<e.streams.length;s++)u(s);o.next=25;break;case 23:e.loading=!1,r(!1);case 25:case"end":return o.stop()}},null,e)})}},{key:"audioStream",value:function(){if(a.default.ndef(this.streams))return null;for(var e=0;e!=this.streams.length;e++){var t=this.streams[e];if(t.type===f.kStreamType.audio||t.type===f.kStreamType.muxed)return t.rep}return null}},{key:"codecs",value:function(){return this.streams.map(function(e){return e.codecs()})}},{key:"currentBitrate",value:function(){var e=this.videoRep();return a.default.ndef(e)?0:e.bandwidth/1e3}},{key:"currentResolution",value:function(){var e=this.videoRep();return a.default.ndef(e)?"uninitialized":e.width+"x"+e.height}},{key:"fillBuffers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this.mpd.type===f.kMPDType.dynamic;if(this.loading)return Promise.resolve([-1,-1,-1]);if(this.started&&this.paused)return Promise.resolve([-1,-1,-1]);var r=u.default.now(),i=this.segmentLengths();if(i<0)return Promise.resolve([-1,-1,-1]);var s=i.reduce(function(e,t){return Math.min(e,t)})/2,o=this.streams.map(function(e){return e.rep().startNumber});return n&&o.includes(null)&&this.lastTime&&r-this.lastTime<s?Promise.resolve([-1,-1,-1]):new Promise(function(i){var s=e.bufferTime,l=t||(e.started?e.config.lead:e.config.base),c=Math.min(e.mpd.duration,s+l),f=c<0?0:c,p=0,h=u.default.init().getTime(),v=void 0;return(!n||n&&o.includes(null))&&(e.loading=!0),e.streams.reduce(function(t,o,c){return t.then(function(){var t=o.makePoints(s,n?null:f,r,o.id);t=t.filter(function(e){return a.default.def(e)});var m=o.inCache(t);return(t=t.filter(function(e){return!m.includes(e)})).length>0?e.hooks.run("onBufferStart"):(e.loading=!1,i([-1,-1,-1])),t.reduce(function(n,s,m){return n.then(function(){return o.fillBuffer(s).then(function(n){if(a.default.ndef(n))i([-1,-1,-1]);else if(p+=n,c===e.streams.length-1&&m===t.length-1){e.hooks.run("onBufferEnd");var s=((v=u.default.init().getTime())-h)/1e3;s>l&&(0,d.clearBpsHistory)(),(0,d.pushBpsHistory)((0,d.bps)(p,s));var o=(0,d.kbpsAvg)(),y=(0,d.speedFactor)(o,p,v-h);e.bufferTime=f,e.started=!0,e.loading=!1,e.lastTime=u.default.now(),i([(0,d.bpsAvg)(),y,r])}})})},Promise.resolve())})},Promise.resolve())})}},{key:"imageStream",value:function(){if(a.default.ndef(this.streams))return null;for(var e=0;e!=this.streams.length;e++){var t=this.streams[e];if(t.type===f.kStreamType.image)return t.rep}return null}},{key:"pause",value:function(){return this.paused=!0,this.hooks.run("onPause"),this.video.pause()}},{key:"play",value:function(){return this.paused=!1,this.hooks.run("onPlay"),this.video.play()}},{key:"queueQuality",value:function(e){var t=e.repID;if("auto"===e.name.toLowerCase())return this.qualityAuto=!0,void(this.qualityQueued=null);for(var n=0;n!=this.streams.length;n++)for(var r=this.streams[n],i=0;i!=r.sources.length;i++)if(r.sources[i].id===t)return this.qualityAuto=!1,void(this.qualityQueued={stream:r,repID:t})}},{key:"segmentLengths",value:function(){return null===this.streams||void 0===this.streams?-1:this.streams.map(function(e){return e.segmentLength()})}},{key:"usingHLS",value:function(){if(!(0,p.hlsPreferred)())return!1;var e=this.config.playlist[this.config.track].hls;return!(!a.default.def(e)||!e.url&&!e.gen)}},{key:"qualities",value:function(){var e=[];if(a.default.ndef(this.mpd)||a.default.ndef(this.mpd.adps))return e;var t=this.videoRep();if(a.default.ndef(t))return e;for(var n=0;n!=this.mpd.adps.length;n++){var r=this.mpd.adps[n];if(!(a.default.ndef(r.reps)||r.reps.length<1)){var i=r.reps[0];if(i.type===f.kStreamType.video||i.type===f.kStreamType.muxed)for(var u=0;u!=r.reps.length;u++){var s=r.reps[u];e.push({rep:s,current:t.id==s.id})}}}return e}},{key:"videoRep",value:function(){var e=this.videoStream();return e?e.rep():null}},{key:"videoStream",value:function(){var e=null;if(a.default.ndef(this.streams))return e;for(var t=0;t!=this.streams.length;t++){var n=this.streams[t],r=n.rep();if(r.type===f.kStreamType.video||r.type===f.kStreamType.muxed){e=n;break}}return e}}]),e}();t.State=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var u,s=e[Symbol.iterator]();!(r=(u=s.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=r(n(0)),s=r(n(6)),o=r(n(5)),l=n(13),c=n(2),f=n(1),d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var n={playlist:[],hooks:{},drm:{playready:{url:"",data:""},widevine:{url:"",data:""}},auto:!0,adapt:!0,base:s.default.is("edge")?5e3:1e3,debug:!1,lead:5e3,loop:!1,muted:!1,query:".pepper",recover:!0,start:0,timed:0,track:0,ui:!0};this.config=(0,c.mergeDicts)(t,n),this.lazyStart=!1,this.initialized=!1,this.config.playlist.length>0&&this.setup_()}return a(e,[{key:"setup_",value:function(){var e=this,t=function(){if(e.initialized=!0,e.hooks=new o.default(e.config.hooks),!e.config.query.length||e.config.query.length<1)throw"Invalid insertion query";e.config.base<100&&(e.config.base=100),e.config.lead<1e3&&(e.config.lead=1e3),e.renderCallback=function(){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return e.state=new l.State(e.config,e.hooks),n.next=4,regeneratorRuntime.awrap(e.state.setup(function(){return e.recoverError_()}));case 4:if(!((t=e.state.config.timed)>0)){n.next=9;break}return e.startsInMs=t,n.abrupt("return");case 9:e.init_();case 10:case"end":return n.stop()}},null,e)},e.renderUI()},n=performance.timing.loadEventEnd,r=["complete","interactive"].indexOf(document.readyState)>-1;n&&r?t():window.addEventListener("DOMContentLoaded",function(){return t()})}},{key:"init_",value:function(){var e,t,n,r;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,regeneratorRuntime.awrap(this.state.init_());case 2:if(this.state.usingHLS()){a.next=15;break}return a.next=5,regeneratorRuntime.awrap(this.state.fillBuffers());case 5:return e=i(a.sent,3),t=e[0],n=e[1],(r=this.state.mpd.type)===f.kMPDType.dynamic&&(this.safariStartTime=e[2]/1e3),a.next=14,regeneratorRuntime.awrap(this.state.adjustQuality(t,n));case 14:this.config.auto&&(r===f.kMPDType.dynamic&&s.default.is("safari")&&(this.state.video.currentTime=this.safariStartTime),this.lazyStart&&!this.browserBlocked||(this.browserBlocked=!1,this.play()));case 15:return a.abrupt("return",Promise.resolve());case 16:case"end":return a.stop()}},null,this)}},{key:"bufferTime",value:function(){return this.state.bufferTime}},{key:"currentBitrate",value:function(){return this.state.currentBitrate()}},{key:"currentResolution",value:function(){return this.state.currentResolution()}},{key:"currentTime",value:function(){return u.default.ndef(this.state)||u.default.ndef(this.state.video)?0:this.forcedCurrentTime?this.forcedCurrentTime+1e3*this.state.video.currentTime:1e3*this.state.video.currentTime}},{key:"didEnd",value:function(){return 1e3*Math.round(this.currentTime()/1e3)>=this.duration()-2e3}},{key:"duration",value:function(){return this.state.mpd.duration}},{key:"isPaused",value:function(){return!!u.default.ndef(this.state)||this.state.paused}},{key:"pause",value:function(){return this.state.pause()}},{key:"play",value:function(){var e,t,n,r,a=this;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.recoverBlock_(),this.initialized){u.next=5;break}return this.lazyStart=!0,u.next=5,regeneratorRuntime.awrap(this.setup_());case 5:return e=this.state.mpd.type,u.prev=6,u.next=9,regeneratorRuntime.awrap(this.state.play());case 9:u.next=19;break;case 11:return u.prev=11,u.t0=u.catch(6),this.hooks.run("onError","browser blocked player start"),this.browserBlocked=!0,u.next=19,regeneratorRuntime.awrap(this.state.pause());case 19:e===f.kMPDType.static?this.state.video.ontimeupdate=function(){var e,t,n;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(a.recoverBlock_(),e=a.currentTime(),t=a.bufferTime(),!(e>=t-a.config.lead/2)){r.next=13;break}return r.next=8,regeneratorRuntime.awrap(a.state.fillBuffers());case 8:n=i(r.sent,2),a.state.adjustQuality(n[0],n[1]);case 13:return a.didEnd()&&(a.hooks.run("onEnd"),a.config.loop?a.reset_():a.pause()),r.abrupt("return",Promise.resolve());case 15:case"end":return r.stop()}},null,a)}:e===f.kMPDType.dynamic&&(t=this.state.segmentLengths(),n=t.reduce(function(e,t){return Math.min(e,t)})/2,r=t.reduce(function(e,t){return Math.max(e,t)}),setInterval(function(){var e,t,n;return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return a.recoverBlock_(),u.next=4,regeneratorRuntime.awrap(a.state.fillBuffers(r));case 4:if(e=i(u.sent,2),n=e[1],a.lastSpeed=t=e[0],!a.config.auto||a.isPaused()){u.next=23;break}return u.prev=10,u.next=13,regeneratorRuntime.awrap(a.state.play());case 13:u.next=23;break;case 15:return u.prev=15,u.t0=u.catch(10),a.hooks.run("onError","browser blocked player start"),a.browserBlocked=!0,u.next=23,regeneratorRuntime.awrap(a.state.pause());case 23:if(!(t>=0&&n>=0)){u.next=26;break}return u.next=26,regeneratorRuntime.awrap(a.state.adjustQuality(t,n));case 26:return u.abrupt("return",Promise.resolve());case 27:case"end":return u.stop()}},null,a,[[10,15]])},this.lastSpeed?r-n*this.lastSpeed:n));case 20:case"end":return u.stop()}},null,this,[[6,11]])}},{key:"renderUI",value:function(){var e=this;if(!this.injectedUI){this.renderInterval&&clearInterval(this.renderInterval);var t=document.querySelector(this.config.query);t?function(t){var n=void 0;if(!t.querySelector("video")){var r=e.state&&e.state.usingHLS();(n=document.createElement("video")).controls=!1,n.autoplay=e.config.auto&&!r,e.config.muted&&(n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),n.muted="muted"),n.addEventListener("click",function(){e.state.video.play().catch(function(){})}),n.addEventListener("contextmenu",function(e){return e.preventDefault()}),t.appendChild(n)}e.injectedUI=!0,e.renderCallback&&e.renderCallback()}(t):this.renderInterval=setInterval(function(){return e.renderUI()},500)}}},{key:"seek",value:function(e){var t,n=this;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(!u.default.ndef(e)){r.next=2;break}return r.abrupt("return");case 2:return this.hooks.run("onPause"),this.config.start=t=this.state.mpd.duration*(e/100),this.forcedCurrentTime=t,this.state.bufferTime=t,this.lazyStart&&(this.initialized=!1,this.lazyStart=!1),this.state=new l.State(this.config,this.hooks),r.next=11,regeneratorRuntime.awrap(this.state.setup(function(){return n.recoverError_()}));case 11:return r.next=13,regeneratorRuntime.awrap(this.init_());case 13:this.hooks.run("onPlay"),this.hooks.run("onSeek");case 15:case"end":return r.stop()}},null,this)}},{key:"qualities",value:function(){return u.default.ndef(this.state)?[]:this.state.qualities()}},{key:"queueQuality",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;u.default.ndef(this.state)||(this.state.qualityAuto=!1,this.state.qualityQueued=e)}},{key:"volume",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return u.default.ndef(this.state)||u.default.ndef(this.state.video)?-1:(e>-1&&e<=1&&(this.state.video.volume=e),this.state.video.volume)}},{key:"reset_",value:function(){var e=this;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return delete this.state,this.state=new l.State(this.config,this.hooks),t.next=5,regeneratorRuntime.awrap(this.state.setup(function(){return e.recoverError_()}));case 5:this.init_();case 6:case"end":return t.stop()}},null,this)}},{key:"recoverError_",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.config.recover){e.next=4;break}return e.next=4,regeneratorRuntime.awrap(this.reset_());case 4:case"end":return e.stop()}},null,this)}},{key:"recoverBlock_",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.browserBlocked){e.next=5;break}return e.next=4,regeneratorRuntime.awrap(this.reset_());case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}},null,this)}}]),e}();t.default=d,t.Player=d}])});