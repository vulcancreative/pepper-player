!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("pepper",[],e):"object"==typeof exports?exports.pepper=e():t.pepper=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=13)}([function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.kMPDType={static:"static",dynamic:"dynamic"},e.kProtocol={hls:"HLS",dash:"DASH"},e.kStreamType={audio:"audio",video:"video",muxed:"muxed",image:"image"},e.kSegmentType={init:"initialization",segment:"segment"},e.kTransitions={countdown:"countdown",immedaite:"immediate"},e.kBackingType={splitX:"splitX",splitY:"splitY",uniform:"uniform"}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t=>null!==t&&void 0!==t,s=t=>!i(t);e.default={def:i,ndef:s,fnc:t=>i(t)&&"function"==typeof t.call,a:(t,e)=>e.getAttribute(t),q:(t,e)=>((t,e)=>(s(e)&&(e=document),e=[].slice.call(e.querySelectorAll(t))))(t,e)}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sizeDict=function(t){return Object.keys(t).length},e.mergeDicts=function(t,e){let i={};for(let s of Object.keys(e))i[s]=null!==t[s]&&void 0!==t[s]?t[s]:e[s];return i},e.randInt=function(t,e){return parseInt(Math.floor(Math.random()*(e-t+1)+t))},e.isInt=function(t){if(isNaN(t))return!1;var e=parseFloat(t);return(0|e)===e}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toInt=(t=>{const e=t%1,i=parseInt(t);return isNaN(e)||isNaN(i)?null:i}),e.msToStamp=(t=>{let e="",i=1e3*Math.floor(t>-1?t:0)/1e3,s=0,n=0,r=0;for(;i>=36e5;)i-=36e5,s++;for(;i>=6e4;)i-=6e4,n++;return r=i/1e3,s>0&&(e+=`${s}:`),e+(s>0?`${n.toFixed(0)}`.padStart(2,"0"):`${n}`)+":"+`${r.toFixed(0)}`.padStart(2,"0")}),e.toDuration=(t=>{const e=[0,0,31536e6,254016e4,6048e5,864e5,36e5,6e4,1e3];return t.match(/(-)?P(?:([.,\d]+)Y)?(?:([.,\d]+)M)?(?:([.,\d]+)W)?(?:([.,\d]+)D)?T(?:([.,\d]+)H)?(?:([.,\d]+)M)?(?:([.,\d]+)S)?/).reduce((t,i,s)=>s<2?0:null===i||void 0===i?t+0:t+i*e[s])}),e.arrayBufferToBase64=(t=>{for(var e="",i=new Uint8Array(t),s=i.byteLength,n=0;n<s;n++)e+=String.fromCharCode(i[n]);return btoa(e)})},function(t,e){"use strict";function i(t,e){const i=(8*(e<1?t*(1/e):t)/e).toFixed(2);return parseFloat(i)}Object.defineProperty(e,"__esModule",{value:!0}),e.bps=i,e.kbps=function(t,e){return parseFloat((i(t,e)/1024).toFixed(2))},e.speedFactor=function(t,e,i){const s=i/1e3,n=(parseFloat(8*e/(1024*t))/parseFloat(s)).toFixed(2);return parseFloat(n)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=(s=i(1))&&s.__esModule?s:{default:s};let r=0,a=!1;const o=()=>Date.now()-r,u=t=>{const e=n.default.def(t)?new Date(t):new Date,i=Date.now()-o();return a?new Date(e.getTime()-i):e};e.default={init:u,now:o,parse:t=>u(t),sync:t=>{r=0,r=o()-t,a=!0},synced:()=>a}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.repToM3U8=e.mpdToM3U8=e.hlsPreferred=e.hlsSupported=e.hlsMimeType=void 0;var s=i(0);const n="application/vnd.apple.mpegurl",r=()=>{let t=document.createElement("video");return t.canPlayType&&!!t.canPlayType("application/vnd.apple.mpegurl")},a=(t,e)=>{const i=t.mpd,r=e.segmentLength(),a=((t,e,i)=>{const n=t.mpd;return(n.type===s.kMPDType.dynamic?e.timeline.slice(0,10):Array(Math.ceil(n.duration/i)).fill()).map((t,r)=>`#EXTINF:${parseFloat(i/1e3).toFixed(5)},\n    ${e.mediaURL(n.type===s.kMPDType.dynamic?t:r+1)}`)})(t,e,r),o="#EXTM3U\n"+`#EXT-X-TARGETDURATION:${parseInt(Math.ceil(r/1e3))}\n`+"#EXT-X-VERSION:7\n"+`#EXT-X-PLAYLIST-TYPE:${"static"===i.type?"VOD":"EVENT"}\n`+"#EXT-X-INDEPENDENT-SEGMENTS\n"+`#EXT-X-MAP:URI="${e.initURL()}"\n`+a.join("\n")+"\n"+`${"static"===i.type?"#EXT-X-ENDLIST":""}`,u=new Blob([o],{type:n});return URL.createObjectURL(u)};e.hlsMimeType=n,e.hlsSupported=r,e.hlsPreferred=(()=>r()&&!("MediaSource"in window)),e.mpdToM3U8=(t=>{const e=[].concat(...t.mpd.adps.map(t=>t.reps)),i=e.filter(t=>t.type===s.kStreamType.audio),n=e.filter(t=>t.type===s.kStreamType.video),r=i.map(e=>{const i=a(t,e);return"#EXT-X-MEDIA:TYPE=AUDIO,"+`GROUP-ID="${e.id}",`+`NAME="${e.id}",`+'LANGUAGE="en-US",AUTOSELECT=YES,DEFAULT=YES,CHANNELS="2",'+`URI="${i}"`}),o=n.map(e=>{const s=a(t,e);return"#EXT-X-STREAM-INF:"+`BANDWIDTH=${e.bandwidth},`+`CODECS="${e.codecs},${i[0].codecs}",`+`RESOLUTION=${e.width}x${e.height},`+`AUDIO="${i[0].id}"\n`+`${s}`});return"#EXTM3U\n#EXT-X-VERSION:6\n#EXT-X-INDEPENDENT-SEGMENTS\n"+r.join("\n")+"\n"+o.join("\n")}),e.repToM3U8=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Stream=void 0;var s=i(2),n=i(3),r=i(0);e.Stream=class{constructor(t={}){this.config=(0,s.mergeDicts)(t,{adp:null,id:null,mediaSource:null,mpd:null,sources:null}),this.mediaSource=this.config.mediaSource,this.adp=this.config.adp,this.id=this.config.id,this.mpd=this.config.mpd,this.sources=this.config.sources,this.mpdWasUpdated=!1}setup(){return new Promise(async t=>{this.cache=await this.init_(),t()})}init_(t=[]){return new Promise(async e=>{const i=this.rep();if(this.type=i.type,this.codecs=`${i.mimeType}; codecs="${i.codecs}"`,!MediaSource.isTypeSupported(this.codecs))return void e(t);this.buffer=this.mediaSource.addSourceBuffer(this.codecs),this.buffer.mode="sequence",this.mpd.type===r.kMPDType.dynamic&&(this.buffer.timestampOffset=.1);const s=await Promise.all(this.sources.map(e=>new Promise(i=>{const s=e.initURL();this.fetchSegment_(s).then(s=>{const n={type:r.kSegmentType.init,rep:e.id,point:0,data:s,size:s.byteLength};t.push(n),i(n)})})));for(let t=0;t!=s.length;t++){const n=s[t];0===n.point&&n.rep===i.id&&this.appendBuffer(this.buffer,n).then(t=>{this.buffer=t,e()})}e(t)})}fetchSegment_(t=""){return new Promise((e,i)=>{const s=this.rep().id,n=this.mpd.type,a=new XMLHttpRequest;a.onload=function(){a.status>=400&&n===r.kMPDType.dynamic?e(null):a.status>=200&&a.status<400?e(a.response):i(`Unable to fetch segment at "${t}" for rep "${s}"`)},a.open("GET",t),a.responseType="arraybuffer",a.send()})}appendBuffer(t,e){return new Promise((i,s)=>{this.rep(),null!==t&&void 0!==t||s("Buffer invalid!"),null!==e&&void 0!==e||s("Segment invalid!");try{t.appendBuffer(new Uint8Array(e.data))}catch(t){}t.onupdateend=(()=>i(t))})}bufferedLength(){const t=this.cache.length;return t<2?0:Math.round((t-1)*this.segmentLength())}fillBuffer(t){return new Promise(async e=>{const i=this.rep(),s=i.mediaURL(t);let a;try{a=await this.fetchSegment_(s)}catch(t){}if(null===a||void 0===a)return void e(null);if(this.type===r.kStreamType.image)return this.cache.push({point:t,mime:i.mimeType,data:(0,n.arrayBufferToBase64)(a),info:i.tileInfo}),void e(a.byteLength);this.cache.push({type:r.kSegmentType.segment,point:t,data:a,size:a.byteLength});const o=this.cache.length-1;this.buffer=await this.appendBuffer(this.buffer,this.cache[o]),e(a.byteLength)})}inCache(t=[]){let e=[],i=t=>{let e,i=0,s=this.cache.length-1,n=this.cache.length-1;if(this.cache.length>0&&this.cache[n].point===t)return n;for(;i<=s;)if((e=this.cache[n=(i+s)/2|0]).point<t)i=n+1;else{if(!(e.point>t))return n;s=n-1}return-1};for(let s=0;s!=t.length;s++){const n=t[s];i(n)>-1&&e.push(n)}if(t.constructor===Array)for(let s=0;s!=t.length;s++){const n=t[s];i(n)>-1&&e.push(n)}else{if(!(0,s.isInt)(t))throw`Invalid argument value : "${t}"`;{const s=t;i(s)>-1&&e.push(s)}}return e}makePoints(t,e,i){const s=this.rep();let n,r=this.lastPoint||0;var a=function(t){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t){var e=[],i=!0,s=!1,n=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done)&&(e.push(r.value),2!==e.length);i=!0);}catch(t){s=!0,n=t}finally{try{!i&&a.return&&a.return()}finally{if(s)throw n}}return e}(t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(s.makePoints(this.mpd,t,e,i,r));return n=a[0],this.lastPoint=r=a[1],n}popCache(t=1){return new Promise((e,i)=>{let s=0;this.cache.length<t+1&&e();for(let t=1;t<this.cache.length;t++)if(this.cache[t].type!==r.kSegmentType.init&&this.cache[t-1].type===r.kSegmentType.init&&this.cache[t].type===r.kSegmentType.segment){s=t;break}0===s&&i(),s+1+t>this.cache.length&&i(),this.cache.splice(s,t),e()})}rep(){return this.mpd.repByID(this.id)}segmentLength(){const t=this.rep();if(null===t&&void 0===t)throw`Unable to determine segment length of rep "${t.id}"`;return t.segmentLength()}switchToRep(t){return new Promise(e=>{for(let i=0;i!=this.cache.length;i++){const s=this.cache[i];0===s.point&&s.rep===t&&this.appendBuffer(this.buffer,s).then(i=>{this.buffer=i;for(let e=0;e!=this.sources.length;e++){const i=this.sources[e];if(i.id===t){this.id=i.id;break}}e()})}})}updateMPD(){this.mpdWasUpdated=!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=(s=i(1))&&s.__esModule?s:{default:s},r=i(3),a=i(0);e.default=class{constructor(t,e,i,s,o){let u,d,l,h,c,p,f,m,y,g,T,v,b,w,P,S,_,M;this.presentationTime=o,u=n.default.a("id",e),P=n.default.a("mimeType",t),n.default.ndef(P)&&(P=n.default.a("mimeType",e)),d=n.default.a("codecs",e);const D=n.default.a("width",e),I=n.default.a("height",e);l=(0,r.toInt)(D)||0,h=(0,r.toInt)(I)||0;const k=n.default.a("bandwidth",e);c=(0,r.toInt)(k),p=s||"";const L=i.split("/"),$=L.length;if(p=$>1?L.slice(0,$-1).join("/"):"/",p+="/"===p.charAt(p.length-1)?"":"/",y=n.default.q("SegmentTimeline",t)[0],n.default.def(y)){const t=[...y.children];v=t,T=this.timeline_(t)}if((g=n.default.q("SegmentTemplate",t)[0])||(g=n.default.q("SegmentTemplate",e)[0]),g){m=n.default.a("media",g),f=n.default.a("initialization",g),n.default.def(f)&&(f=f.replace("$RepresentationID$",u));const t=n.default.a("startNumber",g);b=(0,r.toInt)(t);const e=n.default.a("timescale",g);w=(0,r.toInt)(e);const i=n.default.a("duration",g);S=(0,r.toInt)(i)}if(P&&P.includes("video")&&l&&h?_=a.kStreamType.video:P&&P.includes("audio")&&c?_=a.kStreamType.audio:P&&P.includes("image")&&(_=a.kStreamType.image),_===a.kStreamType.image){let t="1x1";const i=n.default.a("duration",g),s=n.default.q("EssentialProperty",e)[0];s&&(t=n.default.a("value",s)),M={duration:1e3*parseInt(i),count:parseInt(t.split("x")[0]),width:l,height:h}}this.id=u,this.mimeType=P,this.codecs=d,this.width=l,this.height=h,this.bandwidth=c,this.baseURL=p,this.timelineParts=v,this.timeline=T,this.mediaTemplate=m,this.initialization=f,this.startNumber=b,this.timescale=w,this.segmentDuration=S,this.tileInfo=M,this.type=_}initURL(){const t=this.initialization,e=this.baseURL;return(e?`${e}${t}`:t).replace(/\$RepresentationID\$/g,`${this.id}`)}makePoints(t,e,i,s,r=0){return n.default.def(this.timeline)?this.makeTimelinePoints(r):[this.makeTemplatePoints(t,e,i,s),null]}makeTimelinePoints(t){let e,i=0,s=t;for(;s<=t;)s=e=this.timeline[i],i++;if(t===e)throw"last === result";return[[e],e]}makeTemplatePoints(t,e,i,s){const n=this.segmentLength();if("static"===t.type){if(this.type===a.kStreamType.image&&null!==this.tileInfo){const e=Math.ceil(t.duration/this.tileInfo.duration);return new Array(e).fill(0).map((t,e)=>e+1)}const s=parseInt(Math.ceil(parseFloat((i<e?e+1e3:i)-e)/parseFloat(n))),r=parseInt(Math.ceil(parseFloat(e)/parseFloat(n)));return new Array(s).fill(r).map((t,e)=>t+(e+1))}if(t.type===a.kMPDType.dynamic){const e=Math.abs(s-t.startTime);return i&&i>s?Array(1+(i-s)/n).fill().map((t,i)=>(e+n*i)/n-10):[Math.ceil(e/n-10)]}throw`Unable to decipher source type ("${t.type}")`}mediaURL(t){const e=/\$Time\$/g,i=/\$Number\$/g,s=`${t}`;let n=this.mediaTemplate.replace(/\$RepresentationID\$/g,`${this.id}`);if(e.test(n)&&this.timeline.length>0)n=n.replace(e,s);else if(/(\$Number%(\d+)d\$)/g.test(n)){const t=/(\$Number%(\d+)d\$)/g.exec(n),e=parseInt(t[t.length-1])+1,r=s.padStart(e-1,"0");n=(n=n.replace(t[0],r)).replace(i,s)}else n=n.replace(i,s);const r=this.baseURL;return r?`${r}${n}`:n}segmentLength(){if(this.timelineParts&&this.timelineParts.length>0){const t=[];for(let e=0;e<this.timelineParts.length;e++){const i=this.timescale,s=parseInt(this.timelineParts[e].getAttribute("d"));t.push(s/i)}if(t.length>0)return t.reduce((t,e)=>t+e)/t.length*1e3}const t=parseFloat(this.timescale),e=parseFloat(this.segmentDuration);if(null===t&&void 0===t||isNaN(t))return 1e3*e;const i=Math.floor(e/t);return 1e3*parseInt(i)}weight(){return this.width+this.height+this.bandwidth}timeline_(t){let e=[],i=0;for(let s=0;s!=t.length;s++){const r=t[s];let a=parseInt(n.default.a("t",r)),o=parseInt(n.default.a("d",r)),u=parseInt(n.default.a("r",r));a-=this.presentationTime,u=isNaN(u)||u<1?1:u;let d=n.default.def(a)&&!isNaN(a)?a:i;for(let t=0;t!=u;t++){let s=d+o*(t+1);e.push(s),i=s}}return e}}},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=s(i(1)),r=s(i(8)),a=i(3);e.default=class{constructor(t,e,i,s,r){const o=n.default.a("maxWidth",t),u=n.default.a("maxHeight",t);this.adp=t,this.index=e,this.maxWidth=(0,a.toInt)(o),this.maxHeight=(0,a.toInt)(u),this.reps=this.reps_(t,i,s,r)}reps_(t,e,i,s){const a=n.default.q("Representation",t);if(a&&a.length>0){let o=[];for(let n=0;n!=a.length;n++)o.push(new r.default(t,a[n],e,i,s));const u=o.map(t=>n.default.ndef(t.bandwidth)?null:t.bandwidth);if(u.includes(null)){const t=u.findIndex(t=>null!==t),e=t>-1?u[t]:0;o=o.map(t=>(t.bandwidth=e,t))}return o.sort((t,e)=>t.weight()<e.weight()?-1:t.weight()>e.weight()?1:0),o}throw`No representations present in adaptation[${this.index}]`}bestRep(t){return n.default.def(t)?this.matchBandwidth(t):this.reps[this.reps.length-1]}matchBandwidth(t){let e=0,i=this.reps[e].bandwidth;for(let s=1;s<this.reps.length;s++){const n=this.reps[s].bandwidth;Math.abs(.8*t-n)<Math.abs(n-i)&&(e=s,i=n)}return this.reps[e]}}},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.MPD=void 0;var n=s(i(1)),r=s(i(9)),a=s(i(5)),o=i(4),u=i(0),d=i(2),l=i(3);e.MPD=class{constructor(t={}){this.config=(0,d.mergeDicts)(t,{url:"",base:"",data:null}),this.fetchedOnce=!1}async setup(){let t,e=0,i=a.default.init().getTime();const s=await this.fetch_(this.config.url,this.config.data);e+=s.length,t=a.default.init().getTime();const n=(0,o.bps)(e,(t-i)/1e3),r=this.parse_(s);if(r)throw r;return Promise.resolve([this,n])}fetch_(t="",e){return new Promise(i=>{n.default.def(e)&&i(e,"data");const s=new XMLHttpRequest;s.onload=(()=>{const t=s.response;if(this.fetchedOnce||(this.fetchedOnce=!0),n.default.def(t)&&t.includes('"dynamic"')){const t=s.getResponseHeader("Date"),e=new Date(t);a.default.sync(e)}i(t,"xml")}),s.open("GET",t),s.send()})}parse_(t=""){const e=this.config.url,i=this.config.base;return this.mpd=this.xml_(t),this.baseURL=this.baseURL_(this.mpd,i),this.startTime=this.startTime_(this.mpd),this.adps=this.adps_(this.mpd,e,this.baseURL,this.startTime),this.duration=this.duration_(this.mpd),this.dvr=this.dvr_(this.mpd),this.muxed=this.muxed_(this.mpd),this.type=this.type_(this.mpd),this.updatePeriod=this.updatePeriod_(this.mpd),this.adps<0?"Bad adps":"static"==this.type&&-1==this.duration?"Bad duration":this.type<0?"Bad type":this.type==u.kMPDType.dynamic&&(-1==this.startTime||isNaN(this.startTime)||n.default.ndef(this.startTime))?"Bad start time":this.type==u.kMPDType.dynamic&&this.updatePeriod<0?"Bad update period":null}adps_(t,e,i,s){const a=n.default.q("Period",t)[0],o=n.default.q("AdaptationSet",a);if(!o||o.length<1)return-1;const u=[];for(let t=0;t!=o.length;t++)u.push(new r.default(o[t],t,e,i,s));return u}baseURL_(t,e){let i="";return e&&(i=`${e}`),i.length<1&&(i=(i=n.default.q("MPD BaseURL",t)[0])&&i.textContent?i.textContent.trim():"/"),i+("/"!==i.charAt(i.length-1)?"/":"")}duration_(t){const e=n.default.q("MPD",t)[0],i=n.default.a("mediaPresentationDuration",e);return n.default.ndef(i)||!i.hasOwnProperty("length")||i.length<1?-1:(0,l.toDuration)(i)}dvr_(t){const e=n.default.q("MPD",t)[0],i=n.default.a("timeShiftBufferDepth",e);return n.default.ndef(i)||!i.hasOwnProperty("length")||i.length<1?-1:(0,l.toDuration)(i)}muxed_(t){const e=n.default.q("Representation",t)[0];if(!e)return-1;const i=n.default.a("codecs",e);return i.includes("avc")&&i.includes("mp4")}type_(t){const e=n.default.q("MPD",t)[0];let i=n.default.a("type",e);return i&&""!==i.trim()?i.trim():-1}startTime_(t){const e=n.default.q("MPD",t)[0],i=n.default.a("availabilityStartTime",e);return n.default.ndef(i)?-1:a.default.parse(i)}updatePeriod_(t){const e=n.default.q("MPD",t)[0],i=n.default.a("minimumUpdatePeriod",e);if(n.default.ndef(i))return-1;const s=(0,l.toDuration)(i);return s<1e3?1e3:s}xml_(t){return t.querySelectorAll?t:(new DOMParser).parseFromString(t,"text/xml",0)}repByID(t){for(let e=0;e<this.adps.length;e++){const i=this.adps[e];for(let e=0;e<i.reps.length;e++){const s=i.reps[e];if(s.id===t)return s}}throw`Unable to find rep with ID '${t}'`}}},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.State=void 0;var n=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],s=!0,n=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(s=(a=o.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){n=!0,r=t}finally{try{!s&&o.return&&o.return()}finally{if(n)throw r}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=s(i(1)),a=s(i(5)),o=i(10),u=i(7),d=i(2),l=i(0),h=i(4),c=i(6);e.State=class{constructor(t={}){this.config=(0,d.mergeDicts)(t,{playlist:[],hooks:{},base:0,lead:0,start:0,timed:0,track:0,query:""}),this.config.query+=this.config.query.match(/(^|\s)video(\s|\.|$)/)?"":" video"}setup(){return new Promise(async(t,e)=>{const i=document.querySelectorAll(this.config.query)[0];null!==i&&void 0!==i||e("Unable to find root element for insertion query."),i.onerror=(()=>{}),this.video=i,this.paused=!0,this.loading=!1,this.started=!1,this.qualityAuto=!0,this.qualityQueued=null,this.bufferTime=this.config.start,this.config.timed>0?t():(this.mpdUpdateInterval&&clearInterval(this.mpdUpdateInterval),await this.init_(),r.default.fnc(this.config.hooks.onReady)&&this.config.hooks.onReady(),t())})}init_(){return null!==this.mpd&&void 0!==this.mpd?Promise.resolve():new Promise(async t=>{const e=this.config.track;this.mpd=new o.MPD({url:this.config.playlist[e].dash.url,base:this.config.playlist[e].dash.base});var i=await this.mpd.setup(),s=n(i,2);this.mpd=s[0],this.mpdDownloadSpeed=s[1],this.mediaSource=await this.mediaSource_(),this.usingHLS()?t():(this.streams=this.usingHLS()?null:await this.buildStreams_(this.mpd,this.mediaSource),this.mpd.type===l.kMPDType.dynamic&&(this.mpdUpdateInterval=setInterval(async()=>{var t=await this.mpd.setup(),e=n(t,2);this.mpd=e[0],this.mpdDownloadSpeed=e[1]},this.mpd.updatePeriod)),t())})}buildStreams_(t,e){return new Promise(i=>{let s=0,n=[];for(let r=0;r<t.adps.length;r++){const a=t.adps[r],o=a.bestRep(this.mpdDownloadSpeed),d=new u.Stream({adp:a,id:o.id,mediaSource:e,mpd:t,sources:t.adps[r].reps});d.setup().then(()=>{n.push(d),++s===t.adps.length&&i(n)})}})}mediaSource_(){return new Promise((t,e)=>{if(this.usingHLS()){const e=`data:${c.hlsMimeType};base64,${btoa((0,c.mpdToM3U8)(this))}`;this.video.type=c.hlsMimeType,this.video.src=e,t(null)}else{const i=new MediaSource;i.addEventListener("sourceopen",()=>{"open"===i.readyState?t(i):e("Unable to open media source!")}),this.video.src=this.url_(i)}})}url_(t){if(null!==t&&void 0!==t)return URL.createObjectURL(t);throw"Media source is invalid."}adjustQuality(t=0,e=1){return this.loading?Promise.resolve(!1):(this.loading=!0,new Promise(async i=>{if(this.qualityAuto||null===this.qualityQueued)if(this.qualityAuto)for(let s=0;s<this.streams.length;s++){const n=this.streams[s],a=n.adp;let o;if(e>=.5){const t=this.mpd.repByID(n.id);o=a.matchBandwidth(.8*t.bandwidth)}else o=a.matchBandwidth(t);n.id!==o.id?n.switchToRep(o.id).then(()=>{s===this.streams.length-1&&(this.loading=!1,r.default.fnc(this.config.hooks.onAdapt)&&this.config.hooks.onAdapt(this.currentBitrate()),i(!0))}):(this.loading=!1,i(!1))}else this.loading=!1,i(!1);else{const t=this.qualityQueued.stream,e=this.qualityQueued.repID;this.qualityQueued=null,await t.switchToRep(e),this.loading=!1,r.default.fnc(this.config.hooks.onAdapt)&&this.config.hooks.onAdapt(this.currentBitrate()),i(!0)}}))}audioStream(){if(null===this.streams||void 0===this.streams)return null;for(let t=0;t!=this.streams.length;t++){const e=this.streams[t];if(e.type===l.kStreamType.audio||e.type===l.kStreamType.muxed)return e.rep}return null}codecs(){return this.streams.map(t=>t.codecs())}currentBitrate(){const t=this.videoRep();return r.default.ndef(t)?0:t.bandwidth/1e3}currentResolution(){const t=this.videoRep();return r.default.ndef(t)?"uninitialized":`${t.width}x${t.height}`}fillBuffers(t=null){const e=this.mpd.type===l.kMPDType.dynamic;if(this.loading)return Promise.resolve([0,0,0]);if(this.started&&this.paused)return Promise.resolve([0,0,0]);const i=a.default.now(),s=this.segmentLengths().reduce((t,e)=>Math.min(t,e))/2;return e&&this.lastTime&&i-this.lastTime<s?Promise.resolve([0,0,0]):new Promise(s=>{const n=this.bufferTime,o=t||(this.started?this.config.lead:this.config.base),u=Math.min(this.mpd.duration,n+o),d=u<0?0:u;let l,c=0,p=a.default.init().getTime();return this.loading=!0,this.streams.reduce((t,u,f)=>t.then(()=>{let t=u.makePoints(n,e?null:d,i,u.id);t=t.filter(t=>r.default.def(t));let m=u.inCache(t);return(t=t.filter(t=>!m.includes(t))).reduce((e,n,m)=>e.then(()=>u.fillBuffer(n).then(e=>{if(r.default.ndef(e))s([0,0,0]);else if(c+=e,f===this.streams.length-1&&m===t.length-1){const t=((l=a.default.init().getTime())-p)/1e3,e=(0,h.bps)(c,t),n=(0,h.kbps)(c,t),r=(0,h.speedFactor)(n,c,o);this.bufferTime=d,this.started=!0,this.loading=!1,this.lastTime=a.default.now(),s([e,r,i])}})),Promise.resolve())}),Promise.resolve())})}imageStream(){if(null===this.streams||void 0===this.streams)return null;for(let t=0;t!=this.streams.length;t++){const e=this.streams[t];if(e.type===l.kStreamType.image)return e.rep}return null}pause(){return this.paused=!0,r.default.fnc(this.config.hooks.onPause)&&this.config.hooks.onPause(),this.video.pause()}play(){return this.paused=!1,r.default.fnc(this.config.hooks.onPlay)&&this.config.hooks.onPlay(),this.video.play()}queueQuality(t){const e=t.repID;if("auto"===t.name.toLowerCase())return this.qualityAuto=!0,void(this.qualityQueued=null);for(let t=0;t!=this.streams.length;t++){const i=this.streams[t];for(let t=0;t!=i.sources.length;t++)if(i.sources[t].id===e)return this.qualityAuto=!1,void(this.qualityQueued={stream:i,repID:e})}}segmentLengths(){return this.streams.map(t=>t.segmentLength())}usingHLS(){if(!(0,c.hlsPreferred)())return!1;const t=this.config.playlist[this.config.track].hls;return!(!r.default.def(t)||!t.gen&&!t.url)}videoRep(){let t=null;if(r.default.ndef(this.streams))return t;for(let e=0;e!=this.streams.length;e++){const i=this.streams[e].rep();if(i.type===l.kStreamType.video||i.type===l.kStreamType.muxed){t=i;break}}return t}}},function(t,e){"use strict";var i,s,n;Object.defineProperty(e,"__esModule",{value:!0}),e.os=(i=navigator,s=(i.userAgent+" "+i.oscpu).toLowerCase(),n={is:function(t,e){switch(e=/bot|spider|crawl|seeker/,t=t.toLowerCase()){case"safari":return/^((?!chrome).)*safari/.test(s);default:return~s.search(t)||e.test(s)}}}),e.os=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;var s,n=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],s=!0,n=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(s=(a=o.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){n=!0,r=t}finally{try{!s&&o.return&&o.return()}finally{if(n)throw r}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=(s=i(1))&&s.__esModule?s:{default:s},a=i(12),o=i(11),u=i(2),d=i(0);class l{constructor(t={}){this.config=(0,u.mergeDicts)(t,{playlist:[],hooks:{},auto:!0,adapt:!0,base:1e3,debug:!1,lead:5e3,loop:!1,query:".pepper",start:0,timed:0,track:0,ui:!0}),this.lazyStart=!1,this.initialized=!1,this.config.playlist.length>0&&this.setup_()}async setup_(){if(this.initialized=!0,!this.config.query.length||this.config.query.length<1)throw"Invalid insertion query.";this.config.base<100&&(this.config.base=100),this.config.lead<1e3&&(this.config.lead=1e3),this.renderUI(),this.state=new o.State(this.config),await this.state.setup();const t=this.state.config.timed;if(t>0)return this.startsInMs=t,void setTimeout(()=>{this.startsInMs=t>=1e3?t-1e3:t,this.updateTimer_(t>=1e3?t-1e3:t)},1e3);this.init_()}async init_(){if(await this.state.init_(),!this.state.usingHLS()){var t=await this.state.fillBuffers(),e=n(t,3);const i=e[0],s=e[1],r=this.state.mpd.type;r===d.kMPDType.dynamic&&(this.safariStartTime=e[2]/1e3),await this.state.adjustQuality(i,s),this.config.auto&&(r===d.kMPDType.dynamic&&a.os.is("safari")&&(this.state.video.currentTime=this.safariStartTime),this.lazyStart||this.play())}return Promise.resolve()}bufferTime(){return this.state.bufferTime}currentBitrate(){return this.state.currentBitrate()}currentResolution(){return this.state.currentResolution()}currentTime(){return null===this.state||void 0===this.state?0:null===this.state.video||void 0===this.state.video?0:1e3*this.state.video.currentTime}didEnd(){return 1e3*Math.round(this.currentTime()/1e3)>=this.duration()}duration(){return this.state.mpd.duration}isPaused(){return null===this.state||void 0===this.state||this.state.paused}makeActive(){}next(){}pause(){return this.state.pause()}async play(){this.initialized||(this.lazyStart=!0,await this.setup_());const t=this.state.mpd.type;if(await this.state.play(),"static"===t)this.state.video.ontimeupdate=(async()=>{if(this.currentTime()>=this.bufferTime()-this.config.lead/2){var t=await this.state.fillBuffers(),e=n(t,2);this.state.adjustQuality(e[0],e[1])}return this.didEnd()&&(this.state.video.currentTime=0,this.config.loop||(this.pause(),r.default.fnc(this.config.hooks.onStop)&&this.config.hooks.onStop())),Promise.resolve()});else if(t===d.kMPDType.dynamic){const t=this.state.segmentLengths(),e=t.reduce((t,e)=>Math.min(t,e))/2,i=t.reduce((t,e)=>Math.max(t,e));setInterval(async()=>{var t=await this.state.fillBuffers(i),e=n(t,2);const s=e[0],r=e[1];return this.lastSpeed=s,this.config.auto&&!this.isPaused()&&await this.state.play(),this.state.adjustQuality(s,r),Promise.resolve()},this.lastSpeed?i-e*this.lastSpeed:e)}}previous(){}renderUI(){if(!this.injectedUI){const t=r.default.q(this.config.query)[0];if(!r.default.q("video",t)[0]){const e=this.state&&this.state.usingHLS(),i=document.createElement("video");i.controls=!1,i.autoplay=this.config.auto&&!e,i.addEventListener("click",()=>{this.state.video.play().catch(()=>void 0)}),t.appendChild(i)}this.injectedUI=!0}}seek(t){null!==t&&void 0!==t&&(this.config.start=this.state.mpd.duration*(t/100),this.pause(),this.setup_())}updateTimer_(t){t<=0?this.init_():setTimeout(()=>{this.startsInMs-=1e3,this.updateTimer_(t>0?t-1e3:0)},1e3)}}e.default=l,e.Player=l}])});