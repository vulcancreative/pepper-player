!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("pepper",[],t):"object"==typeof exports?exports.pepper=t():e.pepper=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(s){if(i[s])return i[s].exports;var r=i[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,s){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:s})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=11)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sizeDict=function(e){return Object.keys(e).length},t.mergeDicts=function(e,t){let i={};for(let s of Object.keys(t))i[s]=null!==e[s]&&void 0!==e[s]?e[s]:t[s];return i},t.randInt=function(e,t){return parseInt(Math.floor(Math.random()*(t-e+1)+e))},t.isInt=function(e){if(isNaN(e))return!1;var t=parseFloat(e);return(0|t)===t}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toInt=(e=>{const t=e%1,i=parseInt(e);return isNaN(t)||isNaN(i)?null:i}),t.msToStamp=(e=>{let t="",i=1e3*Math.floor(e>-1?e:0)/1e3,s=0,r=0,n=0;for(;i>=36e5;)i-=36e5,s++;for(;i>=6e4;)i-=6e4,r++;return n=i/1e3,s>0&&(t+=`${s}:`),t+(s>0?`${r.toFixed(0)}`.padStart(2,"0"):`${r}`)+":"+`${n.toFixed(0)}`.padStart(2,"0")}),t.toDuration=(e=>{const t=[0,0,31536e6,254016e4,6048e5,864e5,36e5,6e4,1e3];return e.match(/(-)?P(?:([.,\d]+)Y)?(?:([.,\d]+)M)?(?:([.,\d]+)W)?(?:([.,\d]+)D)?T(?:([.,\d]+)H)?(?:([.,\d]+)M)?(?:([.,\d]+)S)?/).reduce((e,i,s)=>s<2?0:null===i||void 0===i?e+0:e+i*t[s])}),t.arrayBufferToBase64=(e=>{for(var t="",i=new Uint8Array(e),s=i.byteLength,r=0;r<s;r++)t+=String.fromCharCode(i[r]);return btoa(t)})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="undefined",s=e=>null===e||typeof e===i;t.default={def:e=>null!==e&&typeof e!==i,ndef:s,a:(e,t)=>t.getAttribute(e),q:(e,t)=>((e,t)=>(s(t)&&(t=document),t=[].slice.call(t.querySelectorAll(e))))(e,t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.kProtocol={hls:"HLS",dash:"DASH"},t.kStreamType={audio:"audio",video:"video",muxed:"muxed",image:"image"},t.kSegmentType={init:"initialization",segment:"segment"},t.kTransitions={countdown:"countdown",immedaite:"immediate"},t.kBackingType={splitX:"splitX",splitY:"splitY",uniform:"uniform"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.kbps=function(e,t){const i=((8*e/t).toFixed(2)/1024).toFixed(2);return parseFloat(i)},t.speedFactor=function(e,t,i){const s=i/1e3,r=(parseFloat(8*t/(1024*e))/parseFloat(s)).toFixed(2);return parseFloat(r)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var s=i(0),r=i(1),n=i(3);t.Stream=class{constructor(e={}){this.config=(0,s.mergeDicts)(e,{mediaSource:null,mpd:null,adp:null,rep:null,sources:null}),this.mediaSource=this.config.mediaSource,this.mpd=this.config.mpd,this.adp=this.config.adp,this.rep=this.config.rep,this.sources=this.config.sources}setup(){return new Promise(e=>{this.init_().then(t=>{this.cache=t,e()})})}init_(e=[]){return new Promise(t=>{if(this.type=this.rep.type,this.codecs=`${this.rep.mimeType}; codecs="${this.rep.codecs}"`,MediaSource.isTypeSupported(this.codecs)){this.buffer=this.mediaSource.addSourceBuffer(this.codecs),this.buffer.mode="sequence","dynamic"===this.mpd.type&&(this.buffer.timestampOffset=.1);for(let i=0;i!=this.sources.length;i++){const s=this.sources[i],r=s.initialization,a=s.baseURL;let o=a?`${a}${r}`:r;o=o.replace(/\$RepresentationID\$/g,`${s.id}`),this.fetchSegment_(o).then(r=>{if(e.push({type:n.kSegmentType.init,rep:s.id,point:0,data:r,size:r.byteLength}),i===this.sources.length-1)for(let i=0;i!=e.length;i++){const s=e[i];0===s.point&&s.rep===this.rep.id&&this.appendBuffer(this.buffer,s).then(i=>{this.buffer=i,t(e)})}})}}else t(e)})}fetchSegment_(e=""){return new Promise((t,i)=>{const s=this.rep.id,r=this.mpd.type,n=new XMLHttpRequest;n.onload=function(){n.status>=400&&"dynamic"===r?t(null):n.status>=200&&n.status<400?t(n.response):i(`Unable to fetch segment at "${e}" for rep "${s}"`)},n.open("GET",e),n.responseType="arraybuffer",n.send()})}appendBuffer(e,t){return new Promise((i,s)=>{null!==e&&void 0!==e||s("Buffer invalid!"),null!==t&&void 0!==t||s("Segment invalid!");try{e.appendBuffer(new Uint8Array(t.data))}catch(e){}e.onupdateend=(()=>i(e))})}bufferedLength(){const e=this.cache.length;return e<2?0:Math.round((e-1)*this.segmentLength())}fillBuffer(e){return new Promise(t=>{const i=this.rep,s=this.buildMediaName_(i,e),a=this.rep.baseURL;this.fetchSegment_(a?`${a}${s}`:s).catch(()=>{}).then(s=>{if(null!==s&&void 0!==s)return this.type===n.kStreamType.image?(this.cache.push({point:e,mime:this.rep.mimeType,data:(0,r.arrayBufferToBase64)(s),info:i.tileInfo}),void t(s.byteLength)):(this.cache.push({type:n.kSegmentType.segment,point:e,data:s,size:s.byteLength}),void this.appendBuffer(this.buffer,this.cache[this.cache.length-1]).then(e=>{this.buffer=e,t(s.byteLength)}));t(null)})})}inCache(e=[]){let t=e=>{let t,i,s=0,r=this.cache.length-1;for(;s<=r;)if((i=this.cache[t=(s+r)/2|0]).point<e)s=t+1;else{if(!(i.point>e))return t;r=t-1}return-1},i=[];if(e.constructor===Array)for(let s=0;s!=e.length;s++){const r=e[s];t(r)>-1&&i.push(r)}else{if(!(0,s.isInt)(e))throw`Invalid argument value : "${e}"`;{const s=e;t(s)>-1&&i.push(s)}}return i}makePoints(e,t,i,s){if(null!==s&&void 0!==s&&null!==s.timeline&&void 0!==s.timeline&&s.timeline.length>0){let e=[];const t=s.timeline[0],i=parseInt(t.getAttribute("t")),r=parseInt(t.getAttribute("d"));return this.lastPoint=(e=[this.lastPoint?this.lastPoint+r:i])[e.length-1],e}if("static"===this.mpd.type){if(s.type===n.kStreamType.image&&null!==s.tileInfo){const e=Math.ceil(this.mpd.duration/s.tileInfo.duration);return new Array(e).fill(0).map((e,t)=>t+1)}const i=parseInt(Math.ceil(parseFloat((t<e?e+1e3:t)-e)/parseFloat(this.segmentLength()))),r=parseInt(Math.ceil(parseFloat(e)/parseFloat(this.segmentLength())));return new Array(i).fill(r).map((e,t)=>e+(t+1))}if("dynamic"===this.mpd.type){const e=Math.abs(i-this.mpd.startTime);return[Math.ceil(e/this.segmentLength()-10)]}throw`Unable to decipher source type ("${this.mpd.type}")`}popCache(e=1){return new Promise((t,i)=>{let s=0;this.cache.length<e+1&&t();for(let e=1;e<this.cache.length;e++)if(this.cache[e].type!==n.kSegmentType.init&&this.cache[e-1].type===n.kSegmentType.init&&this.cache[e].type===n.kSegmentType.segment){s=e;break}0===s&&i(),s+1+e>this.cache.length&&i(),this.cache.splice(s,e),t()})}segmentLength(){const e=this.rep;if(null!==e&&void 0!==e){if(e.timeline&&e.timeline.length>0){const t=[];for(let i=0;i<e.timeline.length;i++){const s=e.timescale,r=parseInt(e.timeline[i].getAttribute("d"));t.push(r/s)}if(t.length>0)return t.reduce((e,t)=>e+t)/t.length*1e3}const t=parseFloat(e.timescale),i=parseFloat(e.segmentDuration);if(null===t&&void 0===t||isNaN(t))return 1e3*i;const s=Math.floor(i/t);return 1e3*parseInt(s)}throw`Unable to determine segment length of rep "${e.id}"`}switchToRep(e){return new Promise(t=>{for(let i=0;i!=this.cache.length;i++){const s=this.cache[i];0===s.point&&s.rep===e&&this.appendBuffer(this.buffer,s).then(i=>{this.buffer=i,this.id=e;for(let t=0;t!=this.sources.length;t++){const i=this.sources[t];if(i.id===e){this.rep=i;break}}t()})}})}buildMediaName_(e,t){const i=/\$Time\$/g,s=/\$Number\$/g,r=`${t}`;let n=e.mediaTemplate.replace(/\$RepresentationID\$/g,`${e.id}`);if(i.test(n)&&e.timeline.length>0)n=n.replace(i,r);else if(/(\$Number%(\d+)d\$)/g.test(n)){const e=/(\$Number%(\d+)d\$)/g.exec(n),t=parseInt(e[e.length-1])+1,i=r.padStart(t-1,"0");n=(n=n.replace(e[0],i)).replace(s,r)}else n=n.replace(s,r);return n}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,r=(s=i(2))&&s.__esModule?s:{default:s},n=i(1),a=i(3);t.default=class{constructor(e,t,i,s){let o,u,l,h,d,c,f,p,m,g,y,v,b,w,_,T,S;o=r.default.a("id",t),w=r.default.a("mimeType",e),r.default.ndef(w)&&(w=r.default.a("mimeType",t)),u=r.default.a("codecs",t);const P=r.default.a("width",t),M=r.default.a("height",t);l=(0,n.toInt)(P)||0,h=(0,n.toInt)(M)||0;const q=r.default.a("bandwidth",t);d=(0,n.toInt)(q),c=s||"";const I=i.split("/"),k=I.length;if(c=k>1?I.slice(0,k-1).join("/"):"/",c+="/"===c.charAt(c.length-1)?"":"/",m=r.default.q("SegmentTimeline",e)[0],r.default.def(m)&&(y=[...m.children]),(g=r.default.q("SegmentTemplate",e)[0])||(g=r.default.q("SegmentTemplate",t)[0]),g){p=r.default.a("media",g),f=r.default.a("initialization",g),r.default.def(f)&&(f=f.replace("$RepresentationID$",o));const e=r.default.a("startNumber",g);v=(0,n.toInt)(e);const t=r.default.a("timescale",g);b=(0,n.toInt)(t);const i=r.default.a("duration",g);_=(0,n.toInt)(i)}if(w&&w.includes("video")&&l&&h?T=a.kStreamType.video:w&&w.includes("audio")&&d?T=a.kStreamType.audio:w&&w.includes("image")&&(T=a.kStreamType.image),T===a.kStreamType.image){let e="1x1";const i=r.default.a("duration",g),s=r.default.q("EssentialProperty",t)[0];s&&(e=r.default.a("value",s)),S={duration:1e3*parseInt(i),count:parseInt(e.split("x")[0]),width:l,height:h}}this.id=o,this.mimeType=w,this.codecs=u,this.width=l,this.height=h,this.bandwidth=d,this.baseURL=c,this.timeline=y,this.mediaTemplate=p,this.initialization=f,this.startNumber=v,this.timescale=b,this.segmentDuration=_,this.tileInfo=S,this.type=T}weight(){return this.width+this.height+this.bandwidth}}},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=s(i(2)),n=s(i(6)),a=i(1);t.default=class{constructor(e,t,i,s){const n=r.default.a("maxWidth",e),o=r.default.a("maxHeight",e);this.adp=e,this.index=t,this.maxWidth=(0,a.toInt)(n),this.maxHeight=(0,a.toInt)(o),this.reps=this.reps_(e,i,s)}reps_(e,t,i){const s=r.default.q("Representation",e);if(s&&s.length>0){let a=[];for(let r=0;r!=s.length;r++)a.push(new n.default(e,s[r],t,i));const o=a.map(e=>r.default.ndef(e.bandwidth)?null:e.bandwidth);if(o.includes(null)){const e=o.findIndex(e=>null!==e),t=e>-1?o[e]:0;a=a.map(e=>(e.bandwidth=t,e))}return a.sort((e,t)=>e.weight()<t.weight()?-1:e.weight()>t.weight()?1:0),a}throw`No representations present in adaptation[${this.index}]`}bestRep(){return this.reps.length-1}strongerRep(e){let t;const i=this.reps;for(let s=0;s!=i.length;s++)if(i[s].id===e){t=i[s];break}let s=t,r=t.weight();for(let e=0;e!=i.length;e++)if(i[e].weight()>r){s=i[e];break}return s}weakerRep(e){let t;const i=this.reps.slice().reverse();for(let s=0;s!=i.length;s++)if(i[s].id===e){t=i[s];break}let s=t,r=t.weight();for(let e=0;e!=i.length;e++)if(i[e].weight()<r){s=i[e];break}return s}worstRep(){return 0}}},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MPD=void 0;var r=s(i(2)),n=s(i(7)),a=i(0),o=i(1);t.MPD=class{constructor(e={}){this.config=(0,a.mergeDicts)(e,{url:"",base:"",data:null})}async setup(){const e=await this.fetch_(this.config.url,this.config.data),t=this.parse_(e);if(t)throw t;return this}fetch_(e="",t){return new Promise(i=>{r.default.def(t)&&i(t,"data");const s=new XMLHttpRequest;s.onload=function(){const e=s.getResponseHeader("Date");new Date(e),Date.now(),i(s.response,"xml")},s.open("GET",e),s.send()})}parse_(e=""){const t=this.config.base;return this.mpd=this.xml_(e),this.baseURL=this.baseURL_(this.mpd,t),this.adps=this.adps_(this.mpd,this.config.url,this.baseURL),this.duration=this.duration_(this.mpd),this.dvr=this.dvr_(this.mpd),this.muxed=this.muxed_(this.mpd),this.type=this.type_(this.mpd),this.startTime=this.startTime_(this.mpd),this.updatePeriod=this.updatePeriod_(this.mpd),this.adps<0?"Bad adps":"static"==this.type&&-1==this.duration?"Bad duration":this.type<0?"Bad type":"dynamic"==this.type&&this.startTime<0?"Bad start time":"dynamic"==this.type&&this.updatePeriod<0?"Bad update period":null}adps_(e,t,i){const s=r.default.q("Period",e)[0],a=r.default.q("AdaptationSet",s);if(!a||a.length<1)return-1;const o=[];for(let e=0;e!=a.length;e++)o.push(new n.default(a[e],e,t,i));return o}baseURL_(e,t){let i="";return t&&(i=`${t}`),i.length<1&&(i=(i=r.default.q("MPD BaseURL",e)[0])&&i.textContent?i.textContent.trim():"/"),i+("/"!==i.charAt(i.length-1)?"/":"")}duration_(e){const t=r.default.q("MPD",e)[0],i=r.default.a("mediaPresentationDuration",t);return r.default.ndef(i)||!i.hasOwnProperty("length")||i.length<1?-1:(0,o.toDuration)(i)}dvr_(e){const t=r.default.q("MPD",e)[0],i=r.default.a("timeShiftBufferDepth",t);return r.default.ndef(i)||!i.hasOwnProperty("length")||i.length<1?-1:(0,o.toDuration)(i)}muxed_(e){const t=r.default.q("Representation",e)[0];if(!t)return-1;const i=r.default.a("codecs",t);return i.includes("avc")&&i.includes("mp4")}type_(e){const t=r.default.q("MPD",e)[0];let i=r.default.a("type",t);return i&&""!==i.trim()?i.trim():-1}startTime_(e){const t=r.default.q("MPD",e)[0],i=r.default.a("availabilityStartTime",t);return r.default.ndef(i)?-1:new Date(i)}updatePeriod_(e){const t=r.default.q("MPD",e)[0],i=r.default.a("minimumUpdatePeriod",t);return r.default.ndef(i)?-1:(0,o.toDuration)(i)}xml_(e){return e.querySelectorAll?e:(new DOMParser).parseFromString(e,"text/xml",0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;var s=i(8),r=i(5),n=i(0),a=i(3),o=i(4);t.State=class{constructor(e={}){this.config=(0,n.mergeDicts)(e,{playlist:[],base:0,lead:0,start:0,timed:0,track:0,query:""}),this.config.query+=this.config.query.match(/(^|\s)video(\s|\.|$)/)?"":" video"}setup(){return new Promise((e,t)=>{const i=document.querySelectorAll(this.config.query)[0];null!==i&&void 0!==i||t("Unable to find root element for insertion query."),i.onerror=(()=>{}),this.video=i,this.paused=!0,this.loading=!1,this.started=!1,this.qualityAuto=!0,this.qualityQueued=null,this.bufferTime=this.config.start,this.config.timed>0?e():this.init_().then(()=>e())})}init_(){return null!==this.mpd&&void 0!==this.mpd?Promise.resolve():new Promise(e=>{const t=this.config.track;this.mpd=new s.MPD({url:this.config.playlist[t].dash.url,base:this.config.playlist[t].dash.base}),this.mpd.setup().then(()=>void 0).then(()=>this.mediaSource_()).then(e=>{this.mediaSource=e}).then(()=>this.buildStreams_(this.mpd,this.mediaSource)).then(t=>{this.streams=t,e()})})}buildStreams_(e,t){return new Promise(i=>{let s=0,n=[];for(let a=0;a<e.adps.length;a++){const o=e.adps[a],u=o.reps[o.bestRep()],l=new r.Stream({mediaSource:t,mpd:e,adp:o,rep:u,sources:e.adps[a].reps});l.setup().then(()=>{n.push(l),++s===e.adps.length&&i(n)})}})}mediaSource_(){return new Promise((e,t)=>{const i=new MediaSource;i.addEventListener("sourceopen",()=>{"open"===i.readyState?e(i):t("Unable to open media source!")});const s=this.url_(i);this.video.src=s})}url_(e){if(null!==e&&void 0!==e)return URL.createObjectURL(e);throw"Media source is invalid."}adjustQuality(e=1){return this.loading?Promise.resolve(!1):(this.loading=!0,new Promise(t=>{if(this.qualityAuto||null===this.qualityQueued)if(this.qualityAuto)for(let i=0;i<this.streams.length;i++){const s=this.streams[i],r=s.adp;let n;if(e>=.6)n=r.weakerRep(s.rep.id);else{if(!(e<=.3))return this.loading=!1,void t(!1);n=r.strongerRep(s.rep.id)}s.switchToRep(n.id).then(()=>{i===this.streams.length-1&&(this.loading=!1,t(!0))})}else this.loading=!1,t(!1);else{const e=this.qualityQueued.stream,i=this.qualityQueued.repID;this.qualityQueued=null,e.switchToRep(i).then(()=>{this.loading=!1,t(!0)})}}))}audioStream(){if(null===this.streams||void 0===this.streams)return null;for(let e=0;e!=this.streams.length;e++){const t=this.streams[e];if(t.type===a.kStreamType.audio||t.type===a.kStreamType.muxed)return t.rep}return null}codecs(){return this.streams.map(e=>e.codecs())}fillBuffers(e=null){const t="dynamic"===this.mpd.type;if(!t&&this.loading)return Promise.resolve();if(this.started&&this.paused)return Promise.resolve();const i=Date.now(),s=this.segmentLengths().reduce((e,t)=>Math.min(e,t))/2;return t&&this.lastTime&&i-this.lastTime<s?Promise.resolve():new Promise(s=>{const r=this.bufferTime,n=e||(this.started?this.config.lead:this.config.base),a=Math.min(this.mpd.duration,r+n);let u,l=0,h=(new Date).getTime();return t||(this.loading=!0),this.streams.reduce((e,d,c)=>e.then(()=>{let e=d.makePoints(r,t?null:a,i,d.rep),f=d.inCache(e);return(e=e.filter(e=>!f.includes(e))).reduce((r,f,p)=>r.then(()=>d.fillBuffer(f).then(r=>{if(null!==r&&void 0!==r){if(l+=r,c===this.streams.length-1&&p===e.length-1){u=(new Date).getTime();const e=(0,o.kbps)(l,(u-h)/1e3),r=(0,o.speedFactor)(e,l,n);this.bufferTime=a,this.started=!0,this.loading=!1,t&&(this.lastTime=i),s([r,i])}}else s(0)})),Promise.resolve())}),Promise.resolve())})}imageStream(){if(null===this.streams||void 0===this.streams)return null;for(let e=0;e!=this.streams.length;e++){const t=this.streams[e];if(t.type===a.kStreamType.image)return t.rep}return null}pause(){return this.paused=!0,this.video.pause()}play(){return this.paused=!1,this.video.play()}queueQuality(e){const t=e.repID;if("auto"===e.name.toLowerCase())return this.qualityAuto=!0,void(this.qualityQueued=null);for(let e=0;e!=this.streams.length;e++){const i=this.streams[e];for(let e=0;e!=i.sources.length;e++)if(i.sources[e].id===t)return this.qualityAuto=!1,void(this.qualityQueued={stream:i,repID:t})}}segmentLengths(){return this.streams.map(e=>e.segmentLength())}videoStream(){if(null===this.streams||void 0===this.streams)return null;for(let e=0;e!=this.streams.length;e++){const t=this.streams[e];if(t.type===a.kStreamType.video||t.type===a.kStreamType.muxed)return t.rep}return null}}},function(e,t){"use strict";var i,s,r;Object.defineProperty(t,"__esModule",{value:!0}),t.os=(i=navigator,s=(i.userAgent+" "+i.oscpu).toLowerCase(),r={is:function(e,t){switch(t=/bot|spider|crawl|seeker/,e=e.toLowerCase()){case"safari":return/^((?!chrome).)*safari/.test(s);default:return~s.search(e)||t.test(s)}}}),t.os=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;var s,r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],s=!0,r=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(s=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){r=!0,n=e}finally{try{!s&&o.return&&o.return()}finally{if(r)throw n}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=(s=i(2))&&s.__esModule?s:{default:s},a=i(10),o=i(9),u=i(0);class l{constructor(e={}){this.config=(0,u.mergeDicts)(e,{playlist:[],auto:!0,adapt:!0,base:1e3,debug:!1,lead:5e3,loop:!1,query:".pepper",start:0,timed:0,track:0,ui:!0}),this.setup_()}async setup_(){if(!this.config.query.length||this.config.query.length<1)throw"Invalid insertion query.";this.config.base<100&&(this.config.base=100),this.config.lead<1e3&&(this.config.lead=1e3),this.renderUI(),this.state=new o.State(this.config),await this.state.setup();const e=this.state.config.timed;if(e>0)return this.startsInMs=e,void setTimeout(()=>{this.startsInMs=e>=1e3?e-1e3:e,this.updateTimer_(e>=1e3?e-1e3:e)},1e3);this.init_()}async init_(){await this.state.init_();var e=await this.state.fillBuffers(),t=r(e,2);const i=t[0],s=this.state.mpd.type;return"dynamic"===s&&(this.safariStartTime=t[1]/1e3),await this.state.adjustQuality(i),this.config.auto&&("dynamic"===s&&a.os.is("safari")&&(this.state.video.currentTime=this.safariStartTime),this.play()),Promise.resolve()}bufferTime(){return this.state.bufferTime}currentTime(){return null===this.state||void 0===this.state?0:null===this.state.video||void 0===this.state.video?0:1e3*this.state.video.currentTime}didEnd(){return 1e3*Math.round(this.currentTime()/1e3)>=this.duration()}duration(){return this.state.mpd.duration}isPaused(){return null===this.state||void 0===this.state||this.state.paused}makeActive(){}next(){}pause(){return this.state.pause()}async play(){const e=this.state.mpd.type;if(await this.state.play(),"static"===e)this.state.video.ontimeupdate=(async()=>{if(this.currentTime()>=this.bufferTime()-this.config.lead/2){const e=await this.state.fillBuffers();this.state.adjustQuality(e)}return this.didEnd()&&(this.state.video.currentTime=0,this.config.loop||this.pause()),Promise.resolve()});else if("dynamic"===e){const e=this.state.segmentLengths(),t=e.reduce((e,t)=>Math.min(e,t))/2,i=e.reduce((e,t)=>Math.max(e,t));setInterval(async()=>{const e=await this.state.fillBuffers(i);return this.lastSpeed=e,this.config.auto&&!this.isPaused()&&this.state.play(),this.state.adjustQuality(e),Promise.resolve()},this.lastSpeed?t-t*this.lastSpeed:t)}}previous(){}renderUI(){if(!this.injectedUI){const e=n.default.q(this.config.query)[0];if(!n.default.q("video",e)[0]){const t=document.createElement("video");e.innerHTML=t.outerHTML}this.injectedUI=!0}}seek(e){null!==e&&void 0!==e&&(this.config.start=this.state.mpd.duration*(e/100),this.pause(),this.setup_())}updateTimer_(e){e<=0?this.init_():setTimeout(()=>{this.startsInMs-=1e3,this.updateTimer_(e>0?e-1e3:0)},1e3)}}t.default=l,t.Player=l}])});